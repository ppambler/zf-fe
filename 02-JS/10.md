| âœï¸ Tangxt | â³ 2020-05-28 | ğŸ·ï¸ JSé«˜é˜¶ç¼–ç¨‹æŠ€å·§ |

# 10-JSé«˜é˜¶ç¼–ç¨‹æŠ€å·§ï¼ˆæŸ¯ç†åŒ–å‡½æ•°æ€æƒ³ï¼‰

> é«˜é˜¶ç¼–ç¨‹æŠ€å·§è¿˜æœ‰å¾ˆå¤šä¸ª -> æœ‰æ—¶å€™æˆ‘ä»¬è¯´è¿™äº›é«˜é˜¶ç¼–ç¨‹æŠ€å·§å°±æ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œå› ä¸ºè¿™äº›æŠ€å·§å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•å†™å‡ºåƒæ¨¡åƒæ ·çš„ä»£ç 

## â˜…ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼Ÿ

åªè¦

**ä¸€ä¸ªå¤§å‡½æ•°æ‰§è¡Œ -> è¿”å›ä¸€ä¸ªå°å‡½æ•°**

é‚£ä¹ˆå°±æ˜¯ï¼šæŸ¯é‡ŒåŒ–

## â˜…æŸ¯é‡ŒåŒ–å¯¹äºæˆ‘ä»¬çš„çœŸå®é¡¹ç›®æ„ä¹‰ä½•åœ¨ï¼Ÿ

æ²¡æœ‰æŸ¯é‡ŒåŒ–ï¼š

![æ— æŸ¯é‡ŒåŒ–](assets/img/2020-05-28-15-27-37.png)

éœ€æ±‚ï¼š

> è§¦å‘ç›’å­ç‚¹å‡»äº‹ä»¶çš„æ—¶å€™ï¼ŒæŠŠfnæ‰§è¡Œäº†ï¼Œå¹¶ä¸”è®©fnä¸­çš„thisæŒ‡å‘objï¼Œå†ç»™fnä¼ é€’ä¸ª200

åšæ³•ï¼š

``` js
box.onclick = fn.bind(obj, 200);
```

`call/apply` éƒ½ä¼šæŠŠå‡½æ•°ç«‹å³æ‰§è¡Œäº†ï¼ˆä¸ç”¨ç‚¹å‡»boxï¼Œä¸€åŠ è½½JSå°±æ‰§è¡Œï¼‰ï¼Œå¦‚è¿™æ ·ï¼š

``` js
box.onclick = fn.call(obj, 200);
box.onclick = fn.apply(obj, [200]);
```

å¯¹äº `bind` æ¥è¯´ï¼Œå®ƒä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè€Œæ˜¯é¢„å…ˆå­˜å‚¨ä¸€äº›å†…å®¹ï¼ä½†æ˜¯ï¼Œå®ƒä¸å…¼å®¹IE6ã€7ã€8ï¼Œè€Œ `call` å’Œ `apply` éƒ½æ˜¯å…¼å®¹IE6ã€7ã€8

å‡å¦‚æˆ‘ä»¬çš„éœ€æ±‚å°±æ˜¯è¦å…¼å®¹IE6ã€7ã€8ï¼Œé‚£ä¹ˆç°åœ¨ç”¨ `bind` è¿™ç§æ–¹å¼å°±GGäº†å‘€ï¼

æ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨å¦ä¸€ç§å§¿åŠ¿æ¥æäº†

### <mark>1ï¼‰åŒ…è£¹ä¸€å±‚åŒ¿åå‡½æ•° + call</mark>

> ç‚¹å‡»æ‰§è¡ŒåŒ¿åå‡½æ•° -> å†æ‰§è¡Œfn

``` js
box.onclick = function() {
  fn.call(obj, 200);
};
```

åŒç†ï¼Œç±»ä¼¼çš„éœ€æ±‚æˆ‘ä»¬éƒ½å¯ä»¥è¿™æ ·æ¥æï¼Œå¦‚ï¼š

æˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚è¿™æ ·ï¼š

``` js
setTimeout(fn, 1000)
```

åœ¨1såï¼Œå†æ‰§è¡Œfnï¼ŒåŒæ ·éœ€è¦æ”¹å˜thisçš„æŒ‡å‘ï¼Œä»¥åŠä¼ å‚ï¼Œæˆ–è®¸ä½ ä¼šå‚»å‚»åœ°è¿™æ ·åšï¼š

``` js
setTimeout(fn.call(obj, 200), 1000);
```

ä½†å…¶å®è¿™ç­‰ä»·äºè¿™æ ·ï¼š

``` js
fn.call(obj, 200);
setTimeout(undefined, 1000);
```

å›è¿‡å¤´æ¥çœ‹ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯1såæ‰§è¡Œfnï¼Œå¯ä¸æ˜¯1såæ‰§è¡Œä¸€ä¸ª `undefined` ï¼Ÿä»€ä¹ˆé¬¼ï¼Ÿ

è€Œä¸”ä¹Ÿä¸æ˜¯ä¸€åŠ è½½JSå°±æ‰§è¡Œ `fn` 

æ‰€ä»¥ï¼Œæ­¤æ—¶ `call` å’Œ `apply` éƒ½ç”¨ä¸äº†äº†ï¼Œè‡³äº `bind` ç”±äºä¸å…¼å®¹IE6ã€7ã€8ï¼Œæ‰€ä»¥è¿™å§¿åŠ¿å°±æ”¾å¼ƒäº†â€¦â€¦

æ‰€ä»¥ï¼Œå‡¡æ˜¯ã€Œå¤šé•¿æ—¶é—´æ‰§è¡Œä¸€ä¸ªfnã€ï¼Œæˆ–è€…ã€Œè§¦å‘äº‹ä»¶æ‰§è¡Œfnã€ç­‰ç­‰è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬éƒ½æƒ³è¦é¢„å…ˆæŠŠè¿™ä¸ªfnçš„thisæŒ‡å‘ä»¥åŠå‚æ•°éƒ½ç»™æŒ‡å®šå¥½å†æ‰§è¡Œfn

è€Œ**è¿™ç§é¢„å…ˆæ€§çš„å¤„ç†å°±æ˜¯æŸ¯é‡ŒåŒ–å‡½æ•°æ€æƒ³ï¼ -> åŸç†æ˜¯ã€Œåˆ©ç”¨é—­åŒ…çš„æœºåˆ¶ï¼ˆä¿å­˜æœºåˆ¶ï¼‰ï¼ŒæŠŠä¸€äº›å†…å®¹äº‹å…ˆå­˜å‚¨å’Œå¤„ç†äº†ï¼Œç­‰åˆ°åæœŸéœ€è¦çš„æ—¶å€™æ‹¿æ¥ç”¨å³å¯ã€**

è€ŒæŸ¯é‡ŒåŒ–è¦è§£å†³çš„é—®é¢˜å°±æ˜¯è¿™ç§ã€Œé¢„å…ˆå¤„ç†ã€

æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„å®šæ—¶å™¨å¯ä»¥å†™æˆè¿™æ ·ï¼š

``` js
setTimeout(function() {
  fn.call(obj, 200);
}, 1000);
```

è¿™åŒä¹‹å‰çš„ï¼š

``` js
box.onclick = function() {
  fn.call(obj, 200);
};
```

ä¸€æ¨¡ä¸€æ ·ï¼ˆæ€æƒ³æ˜¯ä¸€æ ·çš„ï¼ŒåŒ…è£¹ä¸€å±‚å‡½æ•°å°±è¡Œäº†ï¼‰â€¦â€¦åªæ˜¯ä¸€ä¸ªæ˜¯å®šæ—¶è‡ªåŠ¨è§¦å‘ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬ç”¨æˆ·äº¤äº’è§¦å‘ç½¢äº†ï¼

æ‰€ä»¥ï¼Œè¿™æ—¶ï¼Œæœ‰äº†è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼š

é‡åˆ°ä»¥ä¸Šæ‰€è¿°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥å¯¹è¿™ä¸ª `fn` åšé¢„å…ˆå¤„ç†ï¼

å¦‚ `bind` æ–¹æ³•å°±æ˜¯è¿™ä¹ˆæçš„

> çªç„¶è§‰å¾—å‘¨è€å¸ˆè®²JSæ˜¯çœŸå¾—ç‰›é€¼å•Šï¼è¿™çœŸå¾—æ˜¯åœ¨å‘Šè¯‰æˆ‘ä¸ºå•¥éœ€è¦ã€ŒæŸ¯é‡ŒåŒ–å‡½æ•°æ€æƒ³ã€å‘€ï¼ä¾‹å­ä¸¾å¾—å¾ˆè´´è¿‘ç”Ÿäº§é¡¹ç›®å®æˆ˜â€¦â€¦

## â˜…æŸ¯é‡ŒåŒ–å‡½æ•°

### â—‡æ— æ‰©å±•åˆ°åŸå‹çš„æŸ¯é‡ŒåŒ–å‡½æ•°

``` js
/**
 * @description: é¢„å…ˆå¤„ç†å†…å®¹
 *  @param
 *   {Function} func è¦æ‰§è¡Œçš„å‡½æ•°
 *   {Object} context éœ€è¦æ”¹å˜çš„thisæŒ‡å‘
 *   {Array} args ç»™å‡½æ•°ä¼ é€’çš„å‚æ•°
 *  @return:
 *   è¿”å›ä¸€ä¸ªä»£ç†å‡½æ•°ï¼ˆåŒ¿åå‡½æ•°ä¹Ÿè¡Œï¼Œåªæ˜¯æƒ³ç»™æœ‰æ„ä¹‰çš„åå­—ï¼Œå¥½è¯´æ˜æ„å›¾ç½¢äº†ï¼‰
 */
function bind(func, context, ...args) {
  return function proxy() {
    func.call(context, ...args);
  };
}
setTimeout(bind(fn, obj, 200, 300), 1000);
```

è§£é‡Šä¸€ä¸‹ä¸Šè¾¹è¿™ä»£ç ï¼š

![bindæŸ¯é‡ŒåŒ–](assets/img/2020-05-28-23-44-44.png)

> æˆ‘ä»¬çœŸæ­£è¦æ‰§è¡Œçš„é‚£ä¸ªå‡½æ•°æ˜¯ `func` å‘€ï¼

### â—‡æ‰©å±•åˆ°åŸå‹çš„æŸ¯é‡ŒåŒ–å‡½æ•°

``` js
 !(function(proto) {
   function bind(context = window, ...outerArgs) {
     let _this = this;
     return function(...innerArgs) {
       let args = outerArgs.concat(innerArgs);
       _this.call(context, ...args);
     };
   }
   proto.bind = bind;
 })(Function.prototype);
```

![è§£é‡ŠæŸ¯é‡ŒåŒ–](assets/img/2020-05-29-00-41-42.png)

ä¹‹å‰æˆ‘ä»¬ä¸ç”¨ `bind` æ˜¯ä¸ºäº†å…¼å®¹æ€§ï¼Œå¯ç°åœ¨ï¼Œä¸Šè¾¹è¿™ä»£ç æ˜¾ç„¶å­˜åœ¨å…¼å®¹æ€§å“ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å†™äº†ä¸€ä¸ªå…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„å†™æ³•ï¼š

``` js
!(function(proto) {
  function bind(context) {
    context = context || window;
    var _this = this;
    var outerArgs = Array.prototype.slice.call(arguments, 1);
    return function proxy() {
      var innerArgs = [].slice.call(arguments, 0);
      var args = outerArgs.concat(innerArgs);
      _this.apply(context, args);
    };
  }
  proto.bind = bind;
})(Function.prototype);
```

> ä¸Šè¿°æ–¹æ³•å·²ç»èƒ½å¤Ÿè§£å†³ç»å¤§å¤šæ•°çš„bindçš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸Šé¢æ²¡æœ‰è€ƒè™‘åœ¨å¯¹bindä¹‹åçš„å‡½æ•°ä½¿ç”¨newæ“ä½œç¬¦çš„æƒ…å†µ

è¯è¯´ï¼Œä¸Šè¿°è¿™ä¿©æ–¹æ³•æœ‰å•¥ç”¨ï¼Ÿ

å…¶å®æ²¡å•¥ç”¨ï¼Œæ¯•ç«Ÿæ—¥å¸¸å¼€å‘ä¸­ä¸éœ€è¦å»å…¼å®¹`bind`äº†

è€å¸ˆä¸»è¦æ˜¯æƒ³è¦å¤§å®¶æ˜ç™½ã€ŒæŸ¯é‡ŒåŒ–å‡½æ•°ç¼–ç¨‹æ€æƒ³ã€åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæ€ä¹ˆæ¥ç©å„¿å“ˆï¼

### â—‡æˆ‘ä»¬éœ€è¦æŒæ¡çš„

> ä¸Šè¾¹çš„ä¸¤ä¸ªbindæ–¹æ³•ï¼Œç›®å‰ä¸éœ€è¦ç†è§£

æŸ¯é‡ŒåŒ–å‡½æ•°ç¼–ç¨‹æ€æƒ³ï¼š

``` js
function bind(func, context, ...args) {
  return function proxy() {
    func.call(context, ...args);
  };
}
```

åœ¨ redux æºç é‡Œè¾¹ï¼š

![redux-api](assets/img/2020-05-29-01-12-26.png)

è¿˜æœ‰`createStore.js`æ¨¡å—ä¹Ÿæ˜¯å¦‚æ­¤ï¼š

![createStore](assets/img/2020-05-29-01-22-41.png)

è¿˜æœ‰`bindActionCreators.js`ï¼š

``` js
function bindActionCreator(actionCreator, dispatch) {
  return function() {
    return dispatch(actionCreator.apply(this, arguments))
  }
}
```

> è¿”å›ä¸€ä¸ªä»£ç†å‡½æ•°â€¦â€¦

è¿˜ä»¥æŸ¯é‡ŒåŒ–åµŒå¥—ç€æŸ¯é‡ŒåŒ– `applyMiddleware.js`ï¼š

![å¤§é±¼åƒå°é±¼](assets/img/2020-05-29-01-28-46.png)

å¯è§ï¼š

- æŸ¯é‡ŒåŒ–å‡½æ•°ç¼–ç¨‹æ€æƒ³ï¼Œåœ¨çœŸå®é¡¹ç›®é‡Œè¾¹è´¼é¸¡å„¿å¸¸ç”¨
- æˆ‘ä»¬è‡ªå·±å†™ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿç»å¸¸ä¼šæå‡ºå¤§å‡½æ•°è¿”å›ä»£ç†å°å‡½æ•° -> å¤§å‡½æ•°å­˜å‚¨ä¸€äº›å€¼ï¼Œä¾›ä»¥åè°ƒç”¨å°å‡½æ•°æ—¶è°ƒå–ä½¿ç”¨ -> è¿™ä¸€è¿‡ç¨‹æ˜¯åˆ©ç”¨é—­åŒ…æœºåˆ¶å®Œæˆçš„ï¼

## â˜…ä½œä¸šé¢˜

ç¼–å†™ä¸€ä¸ªADDå‡½æ•°æ»¡è¶³å¦‚ä¸‹éœ€æ±‚ï¼š

``` js
add(1);       //1
add(1)(2);    //3
add(1)(2)(3); //6
add(1)(2,3);  //6
add(1,2)(3);  //6
add(1,2,3);   //6
```

â¹ï¼š[æ‰‹å†™ new, call, apply, bind, reduce, curryingï¼Œ é˜²æŠ–èŠ‚æµ æºç ï¼Œå¹¶é…ä¸Šè¯¦ç»†åˆ†æ - æ˜é‡‘](https://juejin.im/post/5eb4c7c96fb9a043807be995#heading-5)

â¹ï¼š[å‰ç«¯åŸºç¡€è¿›é˜¶ï¼ˆåï¼‰ï¼šæ·±å…¥è¯¦è§£å‡½æ•°çš„æŸ¯é‡ŒåŒ– - ç®€ä¹¦](https://www.jianshu.com/p/5e1899fe7d6b)

## â˜…æ€»ç»“

* å½“ä½ å†æ¬¡ä½¿ç”¨bindæ–¹æ³•çš„æ—¶å€™ï¼Œè¯·æƒ³ç€ï¼Œå°±æ˜¯ä¸ºè¿™ä¸ªcallbacké¢„å¤„ç†ä¸€ä¸‹ï¼Œå¦‚æŒ‡å®šå®ƒçš„ `this` ä¸ºå¼€å‘è€…æ‰€æƒ³è¦çš„
* å¤§é±¼åƒå°é±¼ å°é±¼åƒè™¾ç±³

## â˜…Q&A

### <mark>1ï¼‰åœ¨VS Codeé‡Œè¾¹ï¼Œå¦‚ä½•ç»™å‡½æ•°ä¸€ä¸ªæ³¨é‡Šï¼Ÿ</mark>

å‚ç…§ä¸€äº›èŒƒä¾‹ï¼Œå®šä¹‰ä»£ç ç‰‡æ®µ

â¹ï¼š[Use JSDoc: Index](https://jsdoc.app/)

â¹ï¼š[èƒ½è®©ä½ å¼€å‘æ•ˆç‡ç¿»å€çš„ VSCode æ’ä»¶é…ç½®ï¼ˆä¸­ï¼‰ - æ˜é‡‘](https://juejin.im/post/5ad13d8a6fb9a028ce7c0721)

â¹ï¼š[ç¼–ç¨‹æ³¨é‡Šè§„èŒƒ - ç®€ä¹¦](https://www.jianshu.com/p/822aa0077595)

### <mark>2ï¼‰ `...args` è¯­æ³•ï¼Ÿ</mark>

å‰©ä½™å‚æ•°è¯­æ³•å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªä¸å®šæ•°é‡çš„å‚æ•°è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„

``` js
function max() {
  var values = Array.prototype.slice.call(arguments, 0);
  // ...
}
max(1, 2, 3);
```

ç­‰ä»·æ¥çœ‹ï¼š

``` js
function max(...value) {
  // ...
}
max(1, 2, 3);
```

> å®å‚å±•å¼€ï¼Œå½¢å‚æ•°ç»„åŒ–

â¹ï¼š[Rest parameters - JavaScript - MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters)

â¹ï¼š[javascript - What is the meaning of "...args" (three dots) in a function definition? - Stack Overflow](https://stackoverflow.com/questions/42184674/what-is-the-meaning-of-args-three-dots-in-a-function-definition)
