| âœï¸ Tangxt | â³ 2020-06-01 | ğŸ·ï¸ JSé¢è¯•é¢˜ |

# 15-ç»¼åˆé¢è¯•é¢˜è®²è§£1ï¼šé¢å‘å¯¹è±¡

> è¿™äº›é¢è¯•é¢˜ï¼Œéƒ½æ¥è‡ªäºå¤§å‚çš„é¢è¯•é¢˜ -> è®²è§£é¡ºåºï¼Œç”±ç®€å•åˆ°éš¾çš„ï¼ï¼ˆæœ€éš¾çš„æ˜¯é‚£ä¸ªaddå‡½æ•°é¢˜ï¼‰

## â˜…ç¼–å†™pluså’Œminuså®ç°å¦‚ä¸‹éœ€æ±‚

``` js
let n = 10;
let m = n.plus(10).minus(5);
console.log(m);//=>15ï¼ˆ10+10-5ï¼‰
```

åˆ†æï¼š

1. èƒ½å¤Ÿè®©ä¸€ä¸ªæ•°å­—èƒ½è°ƒä¸€ä¸ªæ–¹æ³• -> è¿™å°±æ˜¯é¢å‘å¯¹è±¡é‡Œè¾¹æåˆ°çš„**å®ä¾‹å¯ä»¥è°ƒå–æ‰€å±ç±»åŸå‹ä¸Šçš„æ–¹æ³•**
2. å®ä¾‹è°ƒæ–¹æ³•
   1. é¦–å…ˆçœ‹è¿™æ–¹æ³•æ˜¯ä¸æ˜¯ç§æœ‰çš„ -> ä¸æ˜¯ç§æœ‰çš„ -> å°±æ‰¾å®ƒæ‰€å±ç±»çš„é‚£ä¸ªåŸå‹æ–¹æ³• -> å¦‚æœåŸå‹ä¹Ÿæ²¡æœ‰ï¼Œé‚£å°±ä¸€ç›´å‘ä¸Šæ‰¾å‘—ï¼ç›´åˆ°æ‰¾åˆ°`Object`è¿™ä¸ªåŸºç±»ä¸ºæ­¢
3. å®ä¾‹èƒ½è°ƒä¸çŸ¥åçš„æ–¹æ³• -> æ„å‘³ç€ -> æˆ‘ä»¬éœ€è¦å¾€å®ä¾‹æ‰€å±çš„å†…ç½®ç±»çš„åŸå‹æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•
4. è¯­æ³•åˆç†æ€§ã€è¯­æ³•è§„èŒƒæ€§ -> åŒ¿åå‡½æ•°æ”¹ä¸ºå…·åå‡½æ•°ï¼Œè™½ç„¶æ˜¯å…·åå‡½æ•°ï¼Œä½†åœ¨å…¨å±€æ˜¯ä¸èƒ½ç”¨çš„ï¼åªèƒ½åœ¨è¯¥å…·åå‡½æ•°å†…éƒ¨æœ‰ç”¨ï¼ -> ç”¨äºé€’å½’
5. è€ƒè™‘å®¹é”™æ€§
6. `new Number(10) + 10` -> è¿™æ˜¯å¯ä»¥ç›´æ¥ç›¸åŠ çš„ -> 20

ä»£ç ï¼š

``` js
// å‡½æ•°è¡¨è¾¾å¼ï¼Œä¸è¦åŒ¿åçš„ï¼Œè€Œè¿™æ˜¯è§„èŒƒ
Number.prototype.plus = function plus(num) {
  // this -> æˆ‘ä»¬è¦æ“ä½œçš„é‚£ä¸ªæ•°å­—å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰
  num = Number(num);
  // å®¹é”™æ€§å¤„ç†
  if (isNaN(num)) {
    num = 0;
  }
  // è¿”å›Numberç±»çš„å®ä¾‹ï¼Œå®ç°é“¾å¼å†™æ³• -> ä¸å†™ç”¨new Number(10)è¿™æ ·çš„å§¿åŠ¿
  // ä½ çœ‹æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä¸€ä¸ªæ•°å­—è°ƒç”¨ä¸€ä¸ªæ–¹æ³•
  return this + num;
};

Number.prototype.minus = function minus(num) {
  num = Number(num);
  if (isNaN(num)) {
    num = 0;
  }
  return this - num;
};

let n = 10;
let m = n.plus(10).minus(5);
console.log(m); //=>15ï¼ˆ10+10-5ï¼‰
console.log(n.plus(20)); //  -> 30
```

å¯¹æ¯”è‡ªå·±çš„ç­”æ¡ˆï¼š

- æ²¡æœ‰åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆç†
- è¿”å›å€¼å…¶å®ä¸ç”¨è¿”å›ä¸€ä¸ª`new Number()`ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªæ•°å€¼å°±å¯ä»¥äº†
- `new Number(10) + 10` -> è¿™æ˜¯å¯ä»¥ç›´æ¥ç›¸åŠ çš„ -> 20ï¼Œä¸éœ€è¦ä½ `valueOf()`ä¸€ä¸‹ï¼Œå†ç›¸åŠ ï¼

ä»£ç ä¼˜åŒ–ï¼š

> æå–é‡å¤ä»£ç  -> åˆ›å»ºä¸€ä¸ªå‡½æ•° -> ä¸€èˆ¬ç°åœ¨ç”¨å‡½æ•°è¡¨è¾¾å¼æ¥åˆ›å»ºï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡½æ•°å£°æ˜æå‡ -> ä¿è¯æ˜¯çœŸæ­£çš„å…ˆåˆ›å»ºå†ä½¿ç”¨ï¼Œå³å†™åœ¨åè¾¹çš„å‡½æ•°ï¼Œä¸èƒ½æå‡åˆ°å‰è¾¹å»ï¼ä¸ç„¶è¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„æ€ç»´ä¹ æƒ¯ï¼

``` js
!(function anonymous(proto) {
  const checkNum = function checkNum(num) {
    num = Number(num);
    if (isNaN(num)) {
      num = 0;
    }
    return num;
  };

  Number.prototype.plus = function plus(num) {
    return this + checkNum(num);
  };

  Number.prototype.minus = function minus(num) {
    return this - checkNum(num);
  };
})(Number.prototype);
```

çŸ¥è¯†ï¼š

ä»¥åæˆ‘ä»¬åœ¨å®ç°ä¸€ä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼š

1. å®ç°åŠŸèƒ½ -> ä»£ç å¯èƒ½å¹¶ä¸å¥½çœ‹
2. æå–å†—ä½™ä»£ç  -> å¦‚æ£€æŸ¥å‚æ•°æ˜¯å¦åˆç†
3. ä¿è¯ç§æœ‰åŒ–ï¼ˆé˜²æ­¢ä¸äººå®¶çš„ä¸œè¥¿å†²çªï¼‰ -> é—­åŒ…ï¼ˆå…·åå‡½æ•°ï¼Œè€å¸ˆè®¤ä¸ºé—­åŒ…å°±æ˜¯ä¸ªå‡½æ•°ï¼Œå¦‚è‡ªæ‰§è¡Œå‡½æ•°ï¼‰åŒ…èµ·æ¥ -> å¤šå¤„ç”¨åˆ°çš„å˜é‡ï¼Œå¦‚`xxx.prototype`å°±ç”¨ä¸ªå½¢å‚æå–å‡ºæ¥
4. ä¿è¯å¯æ‰©å±•æ€§ -> ä¸‹æ¬¡è¿½åŠ æ–¹æ³•ï¼Œç›´æ¥æ·»åŠ å³å¯

---

<mark>Qï¼šã€Œä¸ºå•¥`new Number(10) + 10`è¿”å›20ï¼Ÿã€</mark>

å› ä¸ºNumberç±»å‹æœ‰ç‰¹æ®Šæ€§ï¼š`[[PrimitiveValue]]: 10`

Numberç±»å‹çš„å€¼åœ¨åŠ ä¸€ä¸ªæ•°å€¼çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨valueOfæ–¹æ³•ï¼Œå³`(new Number(10)).valueOf()` -> è¿”å›10

è€Œæ•°ç»„åœ¨åŠ ä¸€ä¸ª10çš„æ—¶å€™ï¼Œå³`[10]+10`ï¼Œåˆ™ä¼šè°ƒç”¨`[10].toString()` -> è¿”å›`"1010"`

---

<mark>Qï¼šã€Œä¸ºå•¥`10.plus(10)`ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Ÿã€</mark>

![æ•°å­—æŠ¥é”™](assets/img/2020-06-02-14-38-10.png)

> å› ä¸º`10.`çš„`.`è¢«è§†ä¸ºæµ®ç‚¹æ•°çš„ç‚¹ï¼Œæˆ‘ä»¬åŠ `()`æ„å‘³ç€`.`ä¸æ˜¯æµ®ç‚¹æ•°çš„ç‚¹ï¼Œè€Œæ˜¯ç”¨äºå¯¹è±¡æ–¹æ³•çš„ç‚¹è¿ç®—ç¬¦ï¼Œç”±äºéœ€è¦è°ƒç”¨æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠ`10`åŒ…è£…æˆ`Number`å¯¹è±¡ï¼Œä»¥æ­¤æ¥è°ƒç”¨å®ƒçš„`toString`æ–¹æ³•ï¼

é¢˜å¤–è¯ï¼š

åˆ›å»ºä¸€ä¸ªæ•°æ®ç±»å‹å€¼ï¼ˆæœ‰ä¸¤ç§å§¿åŠ¿ï¼‰ï¼š

1. å­—é¢é‡æ–¹å¼
2. æ„é€ å‡½æ•°æ–¹å¼

ä½†ä¸è®ºå“ªä¸€ç§æ–¹å¼ï¼Œ**æ‰€åˆ›å»ºå‡ºæ¥çš„ç»“æœéƒ½æ˜¯æ‰€å±ç±»çš„å®ä¾‹**

å¦‚ï¼š

``` js
let x = 10 // -> å­—é¢é‡æ–¹å¼
let y = new Number(10) // -> æ„é€ å‡½æ•°æ–¹å¼
```

å½“ç„¶ï¼Œå¯¹äºåŸºæœ¬ç±»å‹è€Œè¨€ï¼Œè¿™ä¸¤ç§å§¿åŠ¿æ˜¯ä¸ä¸€æ ·çš„ï¼š

1. å­—é¢é‡æ–¹å¼åˆ›å»ºå‡ºæ¥çš„æ˜¯ã€ŒåŸºæœ¬ç±»å‹å€¼ã€
2. æ„é€ å‡½æ•°æ–¹å¼åˆ›å»ºå‡ºæ¥çš„åˆ™æ˜¯ã€Œå¼•ç”¨ç±»å‹å€¼ã€

è¿™ä¸€ç‚¹ï¼Œä½ æ‰“logå°±èƒ½çœ‹å‡ºæ¥äº†ï¼š

![åŸºæœ¬ç±»å‹å€¼çš„åˆ›å»ºæ–¹å¼çš„å¼‚åŒ](assets/img/2020-06-02-14-45-29.png)

å½“ç„¶ï¼Œä¸ç®¡ç”¨å“ªç§å§¿åŠ¿åˆ›å»ºå‡ºæ¥çš„ï¼Œå®ƒä»¬éƒ½æ˜¯`Number`çš„å®ä¾‹ï¼Œéƒ½å¯ä»¥è°ƒç”¨Numberçš„åŸå‹æ–¹æ³•ï¼Œåªæ˜¯ä¸€ä¸ªæ˜¯åŸºæœ¬ç±»å‹å€¼ï¼Œä¸€ä¸ªæ˜¯å¼•ç”¨ç±»å‹å€¼ï¼Œè¯´ç™½äº†ï¼Œå®ƒåœ¨å†…å­˜é‡Œè¾¹çš„å­˜å‚¨ä½ç½®æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªæ˜¯Stackï¼Œä¸€ä¸ªåˆ™æ˜¯Heap

> é”™è¯¯è®¤è¯†ï¼šèƒ½è°ƒç”¨æ–¹æ³•ï¼Œå¯ä¸æ˜¯å¾—æ»¡è¶³åƒ`{}`è¿™æ ·çš„æ•°æ®ç»“æ„æ‰æœ‰çš„èƒ½åŠ›ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸º`(1).toString()`æ˜¯æŠŠ`1`å¯¹è±¡åŒ–äº†ï¼Œå†å»è°ƒç”¨ï¼Œå…¶å®ä¸ç„¶å•Šï¼åªè¦æ˜¯å±äºæŸä¸ªç±»çš„å®ä¾‹éƒ½å¯ä»¥å»è°ƒç”¨ï¼Œå³ä¾¿å½¢å¼ä¸Šæœ‰æ‰€ä¸åŒï¼è€Œä¸”æˆ‘ä»¬æœ‰å…ˆå…¥ä¸ºä¸»çš„è§‚å¿µï¼Œå³èƒ½è°ƒç”¨æ–¹æ³•ï¼Œå¿…é¡»å¾—æ˜¯`{}`è¿™æ ·çš„æ•°æ®ç»“æ„ï¼
> 
> æ­£ç¡®è®¤è¯†ï¼šæŠŠåŸºæœ¬ç±»å‹å€¼åŒ…è£…äº†ä¸€ä¸‹å†å»è°ƒç”¨â€¦â€¦

å¯¹äº†ï¼Œæˆ‘ä»¬è¿™æ ·å†™ï¼š

``` js
y.valueOf() === 10 // -> true
```

å…¶å®å°±æ˜¯åœ¨è·å–yå¯¹è±¡çš„åŸå§‹å€¼ï¼Œå³åŸºæœ¬ç±»å‹æ•°å­—`10`

å½“æˆ‘ä»¬`y+10`çš„æ—¶å€™ï¼Œæ˜¯å…ˆè°ƒç”¨`valueOf()`æ‹¿åˆ°åŸºæœ¬ç±»å‹å€¼ï¼ˆåŸå§‹å€¼ï¼‰å†å»ç›¸åŠ ï¼

ä¸è¿‡ï¼Œå¯¹äºå¼•ç”¨ç±»å‹è€Œè¨€ï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®ç±»å‹å€¼çš„ä¸¤ç§å§¿åŠ¿å’©æœ‰åŒºåˆ«ï¼š

``` js
let x = [10]
let y = new Array(10) // -> åˆ›å»ºä¸€ä¸ªæ•°ç»„é•¿åº¦ä¸º10çš„æ•°ç»„
y = new Array('10') // -> ä¸€ä¸ªæ•°ç»„å…ƒç´ '10'
y = new Array(10,0) // -> ä¸¤ä¸ªæ•°ç»„å…ƒç´ 
```

å› ä¸ºåˆ›å»ºå‡ºæ¥çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹å€¼ï¼

å…³äºåŠ åœ†æ‹¬å·è°ƒç”¨æ–¹æ³•ï¼š

``` js
(1).toString();
[1].toString();
({name:'hi'}).toString();
```

æ³¨æ„åŠ åˆ†å·ï¼Œä¸åŠ åˆ†å·ä¼šæŠ¥é”™çš„ï¼š

![å­—é¢é‡åŠ ä¸åŠ åœ†æ‹¬å·è°ƒç”¨æ–¹æ³•](assets/img/2020-06-02-15-12-18.png)

> å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²å€¼ï¼Œä¸ç”¨åŠ åœ†æ‹¬å·ï¼ -> ä½†å»ºè®®æœ€å¥½åŠ ä¸Šï¼Œè¿™æ ·å°±ä¸ç”¨è®°é‚£ä¹ˆå¤šä¸œè¥¿äº†ï¼å°±åƒæ˜¯ä¼˜å…ˆçº§ï¼Œä½ åŠ äº†åœ†æ‹¬å·ï¼Œå°±ä¸ç”¨è€ƒè™‘ä¼˜å…ˆçº§äº†ï¼

## â˜…ç”»å›¾è®¡ç®—ä¸‹é¢çš„ç»“æœ

``` js
function fun(){
    this.a=0;
    this.b=function(){
        alert(this.a);
    }
}
fun.prototype={
    b:function(){
        this.a=20;
        alert(this.a);
    },
    c:function(){
        this.a=30;
        alert(this.a)
    }
}
var my_fun=new fun();
my_fun.b();
my_fun.c();
```

åˆ†æï¼š

![é¢˜6](assets/img/2020-06-02-17-42-40.png)

---

<mark>Qï¼šã€Œlet x = 10çš„è¿ç®—é¡ºåºï¼Ÿã€</mark>

ä¹‹å‰è€å¸ˆè®²çš„æ˜¯ï¼š

1. let x
2. 10
3. å…³è”

ç°åœ¨åˆ™æ˜¯ï¼ˆèµ‹å€¼è¿ç®—ç¬¦ï¼Œå³ä¾§å…ˆè¡Œï¼‰ï¼š

1. 10
2. let x
3. å…³è”

å½“ç„¶ï¼Œä¸ç®¡é¡ºåºæ˜¯å’‹æ ·çš„ï¼Œè¿™éƒ½ä¸ä¼šå½±å“æˆ‘ä»¬çš„ä»£ç è¿è¡Œï¼

å…¶å®åœ¨æˆ‘çœ‹æ¥åº”è¯¥æ˜¯è¿™æ ·ï¼š

1. let x -> å˜é‡æå‡ -> å£°æ˜äº†ä½†æœªåˆå§‹åŒ–ï¼Œå¦‚æœæ˜¯`var`å£°æ˜çš„ï¼Œé‚£å°±æ˜¯ã€Œå£°æ˜å¹¶åˆå§‹åŒ–ä¸º`undefined`å€¼ã€
2. 10 -> åˆ›å»ºä¸€ä¸ªå€¼ï¼ˆåœ¨Stacké‡Œè¾¹ï¼‰
3. x = 10 -> å…³è”ï¼Œåˆå§‹åŒ–ï¼Œå¦‚æœæ˜¯`var`å£°æ˜çš„ï¼Œé‚£å°±æ˜¯ã€Œå…³è”ï¼Œèµ‹å€¼ã€äº†

---

<mark>Qï¼šã€Œé‡ç½®ç±»çš„åŸå‹æŒ‡å‘ï¼Ÿã€</mark>

æ„é€ å‡½æ•°å¯èƒ½ä¼šä¸¢å¤±ï¼ˆ99%çš„å¯èƒ½ï¼‰

ä¸ºäº†ä¿è¯åŸå‹å’ŒåŸå‹é“¾æœºåˆ¶çš„å®Œæ•´æ€§ï¼Œè¯·æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹æ„é€ å‡½æ•°

æ¯•ç«Ÿæˆ‘ä»¬è¦é€šè¿‡å®ƒæ˜¾ç¤ºç¡®ä¿ä¸€ä¸‹ï¼Œè¿™ä¸ª`fun.prototype`æ˜¯å±äºå“ªä¸ªç±»çš„åŸå‹ï¼Œè€ŒçŸ¥é“äº†è¿™æ˜¯å“ªä¸ªç±»çš„åŸå‹ï¼Œé‚£ä¹ˆå®ä¾‹å°±å¤ŸçŸ¥é“è‡ªå·±çš„åŸå‹é“¾`__proto__`è¯¥æŒ‡å‘è°äº†ï¼Œå½“ç„¶ï¼Œæ²¡æœ‰`constructor`ä¹Ÿèƒ½æŒ‡å‘ï¼Œåªæ˜¯å†™äº†ä¼šæ›´å¥½ï¼Œæ›´å®¹æ˜“è®©æˆ‘ä»¬å¼€å‘è€…çŸ¥é“è¿™ä¸ªå®ä¾‹çš„åŸå‹é“¾æŒ‡å‘ æˆ–è€… è¯¥å®ä¾‹æ˜¯è°newå‡ºæ¥çš„ï¼

æ›´ä½•å†µï¼Œ`constructor`æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ä¸œè¥¿ï¼Œå°¤å…¶æ˜¯åœ¨åå°ï¼Œå¦‚Javaè¯­è¨€é‡Œè¾¹ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹‹ååœ¨ææ·±æ‹·è´çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°`constructor`ï¼Œæ—¢ç„¶æœ‰ç”¨åˆ°å®ƒï¼Œå¯å¦‚æœä½ æŠŠå®ƒç»™åˆ äº†ï¼Œé‚£å°±ä¸å¥½äº†ï¼

æ€»ä¹‹ï¼Œå¿…é¡»è¦æœ‰`constructor`ï¼Œä¸ç„¶å¦‚æœå‡ºç°è¦ä½¿ç”¨`constructor`çš„åœºæ™¯ï¼Œé‚£å°±GGäº†ï¼

> ä¸€èˆ¬æ¥è¯´ï¼Œ`constructor`å’©å•¥ç”¨ -> é‡ç½®ç±»çš„åŸå‹æŒ‡å‘ï¼Œå¿…é¡»è¦åŠ ä¸Š`constructor`å±æ€§ -> è¿™å¹¶ä¸ä¼šå½±å“åˆ°è¿™ä¸ªç±»çš„å®ä¾‹ï¼Œæ¯•ç«Ÿå®ä¾‹çš„åŸå‹é“¾ä¸`Xxx.prototype`ç»‘å®šäº†ï¼Œå³å®ƒæŒ‡å‘è°ï¼Œæˆ‘å°±æŒ‡å‘è°ï¼ -> `xxx.__proto__ === Xxx.prototype`
> 
> å¦‚æœä½ å’©æœ‰æ‰‹åŠ¨è®¾ç½®æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººé—®ä½ ã€Œxxx.constructorã€æ˜¯å¤šå°‘çš„æ—¶å€™ï¼Œåªèƒ½ä¸€ç›´å¾€åŸå‹é“¾æ‰¾äº†ï¼Œè€Œè¿™æ ·å°±ä¹±å¥—äº†ï¼Œæ¯”å¦‚è¯´ï¼š

![æ‰‹åŠ¨è®¾ç½®constructor](assets/img/2020-06-02-17-20-13.png)

ä¸Šä¸€ç¯‡çš„é‚£ä¸ªé—®é¢˜ï¼šã€Œ`Function.prototype`æ˜¯ä¸ªå‡½æ•°ã€

![ä¸€ä¸ªbug](assets/img/2020-06-02-17-34-45.png)

â¹ï¼š[Function.prototype å±…ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/40007030)

---

## â˜…å†™å‡ºä¸‹é¢ä»£ç æ‰§è¡Œè¾“å‡ºçš„ç»“æœ

``` js
function C1(name) {
    if (name) {
        this.name = name;
    }
}
function C2(name) {
    this.name = name;
}
function C3(name) {
    this.name = name || 'join';
}
C1.prototype.name = 'Tom';
C2.prototype.name = 'Tom';
C3.prototype.name = 'Tom';
alert((new C1().name) + (new C2().name) + (new C3().name));
```

> ç¡®å®šnewçš„æ—¶å€™ï¼Œæ˜¯å¦æ·»åŠ ç§æœ‰å±æ€§ï¼Œé¢˜ç›®é‡Œè¾¹é‚£ä¸ªåˆ¤æ–­å°±æ˜¯åœ¨è€ƒå¯Ÿã€Œç§æœ‰å±æ€§çš„æ·»åŠ ä¸å¦ã€ -> å®ä¾‹çš„ç§æœ‰å±æ€§å’©æœ‰ï¼Œé‚£å°±ä¼šåˆ°å…¬æœ‰å±æ€§ä¸Šè¾¹å»æ‰¾

åˆ†æè¿‡ç¨‹ï¼š

``` js
function C1(name) {
  //=>name:undefined æ²¡æœ‰ç»™å®ä¾‹è®¾ç½®ç§æœ‰çš„å±æ€§name
  if (name) {
    this.name = name;
  }
}

function C2(name) {
  this.name = name;
  //=>ç»™å®ä¾‹è®¾ç½®ç§æœ‰å±æ€§name =>this.name=undefined
}

function C3(name) {
  this.name = name || "join";
  //=>ç»™å®ä¾‹è®¾ç½®ç§æœ‰å±æ€§name =>this.name=undefined || 'join'
}
C1.prototype.name = "Tom";
C2.prototype.name = "Tom";
C3.prototype.name = "Tom";
alert(new C1().name + new C2().name + new C3().name);
//=> (new C1().name) æ‰¾åŸå‹ä¸Šçš„ 'Tom'
//=> (new C2().name) æ‰¾ç§æœ‰å±æ€§ undefined
//=> (new C3().name) æ‰¾ç§æœ‰å±æ€§ 'join'
//=> 'Tomundefinedjoin'
```

## â˜…æ€»ç»“

- å¦‚ä½•ä¸ºä¸€ä¸ªå†…ç½®ç±»çš„åŸå‹æ‰©å±•æ–¹æ³•ï¼Œä½ è¦å¿ƒé‡Œæœ‰æ•°å‘€ï¼ -> è¿™æ˜¯åšæ³•æ­¥éª¤çš„ï¼
- ä¸€ä¸ªæ•°å€¼çš„è¯ç”Ÿæœ‰ä¸¤ç§é€”å¾„ -> å­—é¢é‡å’Œ`new Xxx()`
- `Function.prototype`æ˜¯ä¸ªå‡½æ•°å‘€ï¼æˆ‘ä»¬å¯ä»¥`Function.prototype()`ï¼Œä½†å®ƒçš„`Function.prototype.__proto__.constructor`æ˜¯`Object` -> ä¸ºäº†å…¼å®¹ä¹‹å‰çš„ ECMAScript ä»£ç ï¼ˆES6ä¹‹å‰çš„ä»£ç ï¼‰æˆ–è€…è¯´è¿™ä¸ªå‡½æ•°æ˜¯ç©ºå‡½æ•°ï¼Œä¸æ™®é€šå¯¹è±¡æ— å¼‚ï¼Œåªæ˜¯å®ƒå¯ä»¥è°ƒç”¨ç½¢äº†ï¼
- å†æ¬¡å¼ºè°ƒ -> å®ä¾‹çš„ç§æœ‰å±æ€§ã€å¯¹äºå®ä¾‹è€Œè¨€çš„åŸå‹å¯¹è±¡çš„å…¬æœ‰å±æ€§ -> ç¡®å®šç§æœ‰å±æ€§åœ¨äºï¼Œæ„é€ å‡½æ•°çš„`this.xxx = 'hi'`
- å±æ€§ï¼šå­—æ®µå±æ€§å’Œæ–¹æ³•å±æ€§ -> ç§æœ‰æ‰¾ä¸åˆ°éƒ½ä¼šå¾€åŸå‹é“¾ä¸Šæ‰¾ï¼ˆä¸ä»…ä»…æ˜¯æ–¹æ³•å±æ€§ï¼Œè¿˜æœ‰å­—æ®µå±æ€§ï¼‰
- æˆ‘ä»¬è¦ç¡®å®šä¸€ä¸ªå®ä¾‹æ˜¯è°`new`å‡ºæ¥çš„ -> åœ¨å®ä¾‹æ²¡æœ‰`constructor`è¿™ä¸ªç§æœ‰å±æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥ç›´æ¥`xxx.constructor`ï¼ˆæ³¨æ„è¿™ä¸èƒ½æ˜¯åŸå‹å¯¹è±¡ï¼Œå› ä¸ºåŸå‹å¯¹è±¡æœ¬èº«å°±æœ‰ä¸€ä¸ª`constructor`çš„ç§æœ‰å±æ€§ï¼‰ï¼Œå½“ç„¶ï¼Œæœ‰ä¸€ä¸ªä¸‡é‡‘æ²¹å§¿åŠ¿ï¼š`xxx.__proto__.constructor`ï¼Œ`Xxx.prototype.__proto__.constructor` -> æ³¨æ„ï¼šé‡å†™ç±»çš„åŸå‹ï¼Œä¸€å®šè¦æ‰‹åŠ¨æ·»åŠ ç›¸åº”çš„`constructor`å±æ€§ï¼Œä¸ç„¶è¿™ä»£ç åœ¨æŸç§åœºæ™¯ä¸‹ä¼šå˜æˆbugçš„è¯ç”Ÿåœ°ï¼Œå¦‚æˆ‘ä»¬è¦é€šè¿‡`constructor`åˆ¤æ–­ä¸€ä¸ªå®ä¾‹çš„ç›´æ¥ç±»

## â˜…Q&A

### <mark>1ï¼‰`1.toString()`å’Œ`(1).toString()`çš„åŒºåˆ«ï¼Ÿ</mark>

``` js
1toString()    //æŠ¥é”™ï¼Œè¯­æ³•é”™è¯¯
1.toString()   //æŠ¥é”™ï¼ŒJSå¼•æ“æ— æ³•ç¡®å®šè¿™é‡Œçš„`.`æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ˜¯ç‚¹è¿ç®—ç¬¦ï¼ˆå¯¹è±¡æ–¹æ³•ï¼‰è¿˜æ˜¯æµ®ç‚¹æ•°ï¼Ÿ
1..toString()    //æˆåŠŸï¼Œè¿ç®—ç»“æœ"1" è§£æ: ç¬¬äºŒä¸ªç‚¹è¢«è§†ä¸ºç‚¹è¿ç®—ç¬¦ï¼Œå‰é¢çš„æ˜¯æµ®ç‚¹æ•°ã€‚
1.0.toString()   //æˆåŠŸï¼Œè¿ç®—ç»“æœ"1" è§£æ: ç¬¬äºŒä¸ªç‚¹è¢«è§†ä¸ºç‚¹è¿ç®—ç¬¦ï¼Œå‰é¢çš„æ˜¯æµ®ç‚¹æ•°ã€‚
1 .toString()    //æˆåŠŸï¼Œè¿ç®—ç»“æœ"1" è§£æ: ç”¨ç©ºæ ¼å’Œåé¢çš„.toString()éš”å¼€, æŠŠå‰é¢çš„å½“æˆè¿ç®—å¼å¤„ç†
1+2.toString() //æŠ¥é”™ï¼ŒJSå¼•æ“æ— æ³•ç¡®å®šè¿™é‡Œçš„`.`æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ˜¯ç‚¹è¿ç®—ç¬¦ï¼ˆå¯¹è±¡æ–¹æ³•ï¼‰è¿˜æ˜¯æµ®ç‚¹æ•°ï¼Ÿ
1+2 .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"12" è§£æ: ç”¨ç©ºæ ¼å’Œåé¢çš„.toString()éš”å¼€, æŠŠå‰é¢çš„å½“æˆè¿ç®—å¼å¤„ç†
(1+2).toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"3" è§£æ: æ‹¬å·å†…éƒ¨çš„å…ˆè¿›è¡Œç®—æ³•è¿ç®—ï¼Œåœ¨è¿›è¡Œç±»å‹è½¬æ¢
(1)+(2).toString() //è¿ç®—ç»“æœ"12" è§£æ: æ‹¬å·å†…éƒ¨è¿›è¡Œç±»å‹ä¿®æ”¹å¹¶å°†æ•°å­—nè½¬æ¢ä¸ºå­—ç¬¦ä¸²â€œn â€œï¼Œåœ¨è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åå†åº”ç”¨toStringæ–¹æ³•ã€‚
(1)+(2)+0 .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"30" è§£æ: å¦‚æœæœ‰å¤šä¸ª`+`å·ï¼Œä¸”ä¸åŒ…å«ä¸­æ‹¬å·ä¸""çš„æƒ…å†µä¸‹ï¼Œåˆ™æŠŠæœ€åä¸€ä¸ªåŠ å·ä¹‹å‰çš„è¿›è¡Œæ•°å­¦è¿ç®—(ä¸ç®¡ä»–æœ‰æ²¡æœ‰è¢«æ‹¬å·åŒ…ä½)ï¼Œæœ€åä¸€ä¸ªåŠ å·ç•™ä½œæ‹¼æ¥ä½œç”¨ã€‚
(1)+(2)+0+(11) .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"311" è§£æ: åŒä¸Š
(1)+(2)+0+12 .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"312" è§£æ: åŒä¸Š
([1]+[2]+[3])+12 .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"12312" è§£æ: å¦‚æœé‡Œé¢åªæœ‰æ–¹æ‹¬å·(å•ä¸ªæ•°å€¼çš„æ•°ç»„)ï¼Œåˆ™+èµ·è¿æ¥ä½œç”¨
((1)+(2)+[3])+12+43 .toString()//æˆåŠŸï¼Œè¿ç®—ç»“æœ"331243" è§£æ: å¦‚æœé‡Œé¢åŒ…å«åœ†æ‹¬å·ï¼Œåˆ™å…ˆè¦è¿›è¡Œè¿ç®—ï¼Œå†æŠŠè¿ç®—çš„ç»“æœä¸åé¢çš„å†…å®¹æ‹¼æ¥èµ·æ¥ã€‚
(1)+(2)+6+2+5+"(15)"+1+0+(1) .toString() //æˆåŠŸï¼Œè¿ç®—ç»“æœ"16(15)101"è§£æ: å¦‚æœå­—ç¬¦ä¸²åŒ…è£¹çš„å‰é¢æœ‰å¤šä¸ªåŠ å·ï¼Œåˆ™æŠŠå­—ç¬¦ä¸²åŒå¼•å·å‰é¢çš„è¿›è¡Œè¿ç®—(ä¸ç®¡ä»–æœ‰æ²¡æœ‰è¢«åœ†æ‹¬å·åŒ…ä½)ï¼Œå¾—åˆ°çš„æ•°å€¼æ‹¼æ¥ä¸Šå­—ç¬¦ä¸²åŒ…è£¹çš„å†…å®¹å†æ‹¼æ¥ä¸Šä¹‹åçš„å†…å®¹ã€‚
```

æˆ‘ä»¬åŠ `()`åªæ˜¯ä¸ºäº†ä¸è¦è®©JSå¼•æ“å¯¹`.`äº§ç”Ÿäº†æ­§ä¹‰ï¼Œå³è¿™æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ç‚¹ï¼Œè¿˜æ˜¯ä¸€ä¸ªç‚¹è¿ç®—ç¬¦ï¼ˆå¯¹è±¡æ–¹æ³•ï¼‰å‘¢ï¼Ÿ -> æœ‰æ‹¬å·ï¼Œæ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªç‚¹è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆJSå¼•æ“å°±ä¼šåŒ…è£…å®ƒæˆä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥æ­¤æ¥è®¿é—®å¯¹è±¡æ–¹æ³•ï¼

å½“ç„¶ï¼Œå¦‚æœä½ ä¸æƒ³ç”¨`()`åˆ†ç»„ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·ï¼š

``` js
1 .toString() // -> ç©ºæ ¼ç¬¦ï¼Œå·¥ä½œåŸç†ç±»ä¼¼äºåŠ ()
1..toString() // -> ä¸¤ä¸ªç‚¹ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªè¢«è§†ä¸ºç‚¹è¿ç®—ç¬¦ï¼Œå½“ç„¶è¿™æ˜¯æµ®ç‚¹æ•°äº†ï¼Œå¯ä¸æ˜¯æ•´æ•°äº†ï¼
1 //Next Line
.toSring() // '1' -> æ¢è¡Œä¹Ÿè¡Œï¼Œåæ­£åªè¦è®©JSå¼•æ“çŸ¥é“è¿™ä¸ªç‚¹æ˜¯ç‚¹è¿ç®—ç¬¦å°±å¥½äº†ï¼
```

â¹ï¼š[What happened inside of (1).toString() and 1.toString() in Javascript - Stack Overflow](https://stackoverflow.com/questions/38968598/what-happened-inside-of-1-tostring-and-1-tostring-in-javascript)

â¹ï¼š[å…³äº 1toString()ã€1.toString()ã€1..toString()ã€1.0.toString()ã€(1.).toString()ã€1 .toSt - æ˜é‡‘](https://juejin.im/post/5c3ea3bbf265da6163024c50)




















































