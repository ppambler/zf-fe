| âœï¸ Tangxt | â³ 2020-06-12 | ğŸ·ï¸ JS ä¸“é¢˜ |

# 21-ç»¼åˆä¸“é¢˜ä¹‹THISçš„äº”ç§æƒ…å†µ2ï¼ˆé‡å†™å†…ç½®çš„CALLã€APPLYã€BINDï¼‰

## â˜…å‰è¨€

ç®­å¤´å‡½æ•°æ˜¯æ— æ³•é€šè¿‡callç­‰æ–¹æ³•æ¥æŒ‡å®šå…¶é‡Œè¾¹æ‰€è°“çš„ `this` çš„ï¼Œæ¯•ç«Ÿç®­å¤´å‡½æ•°ä¸å­˜åœ¨ `this` â€¦â€¦

ç®€å•æ¥è¯´ï¼Œä½ è¿™æ ·åšï¼š

``` js
var f = () => {
  console.log(this)
}
f.call('hi') // -> this -> window

// å…¨å±€thiså˜é‡
this // -> window
```

![ç®­å¤´å‡½æ•°ä¸this](assets/img/2020-06-13-12-52-30.png)

é¢˜å¤–è¯ï¼š

ç®­å¤´å‡½æ•°æ˜¯ `Function` çš„å®ä¾‹ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ `call` ã€ `apply` ç­‰è¿™æ ·çš„æ–¹æ³•çš„ï¼Œåªæ˜¯æˆ‘ä»¬æ— æ³•åƒnewä¸€ä¸ªæ™®é€šå‡½æ•°é‚£æ ·ï¼Œnewä¸€ä¸ªç®­å¤´å‡½æ•°ç½¢äº†ï¼Œç®€å•æ¥è¯´ï¼Œç®­å¤´å‡½æ•°å°±æ˜¯æ— æ³•æˆä¸ºä¸€ä¸ªå®ä¾‹çš„ç±»ï¼å®ƒåªèƒ½è¢«å½“ä½œè·‘ä¸€æ®µä»£ç çš„è¿‡ç¨‹å°è£…ï¼

---

## â˜… æƒ…å†µäº”ï¼šcall/apply/bind æ”¹å˜ this æŒ‡å‘

è§„å¾‹ï¼š

> THIS5ï¼šåŸºäº `call/apply/bind` å¯ä»¥æ”¹å˜å‡½æ•°ä¸­thisçš„æŒ‡å‘ï¼ˆå¼ºè¡Œæ”¹å˜ï¼‰ï¼Œå½“ç„¶ï¼Œç®­å¤´å‡½æ•°é™¤å¤–ï¼

---

Qï¼šES6å†™ä¸€ä¸ªæ–¹æ³•ï¼Ÿ

``` js
let obj = {
  fn: function() {}
}

let obj1 = {
  fn() {}
}
```

è¿™ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œéƒ½æ˜¯æ™®é€šå‡½æ•°æ–¹æ³•ï¼Œæ³¨æ„è¿™åè€…å¯ä¸æ˜¯ç®­å¤´å‡½æ•°å“ˆï¼

---

### â—‡ `call/apply` 

ç›¸åŒç‚¹ï¼š

* ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æ”¹å˜çš„THISæŒ‡å‘ï¼Œå†™è°å°±æ˜¯è°ï¼ˆç‰¹æ®Šï¼šéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¼ é€’ã€Œnull/undefinedã€æˆ–ã€Œä¸ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ã€æŒ‡å‘çš„ä¹Ÿæ˜¯window -> åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™ç§ç‰¹æ®Šå°±ä¸å­˜åœ¨äº†ï¼‰

å”¯ä¸€åŒºåˆ«ï¼š

æ‰§è¡Œå‡½æ•°ï¼Œä¼ é€’çš„å‚æ•°æ–¹å¼æœ‰åŒºåˆ«ï¼Œcallæ˜¯ä¸€ä¸ªä¸ªçš„ä¼ é€’ï¼Œè€Œapplyåˆ™æ˜¯æŠŠéœ€è¦ä¼ é€’çš„å‚æ•°æ”¾åˆ°æ•°ç»„ä¸­æ•´ä½“ä¼ é€’ï¼Œå¦‚è¿™æ ·ï¼š

``` 
func.call([context],10,20)
func.apply([context],[10,20])
```

å½¢å¼æ¥çœ‹ï¼Œapplyåªç®¡ä¿©å‚æ•°ï¼Œè€Œcallåˆ™æ˜¯ç®¡å¾ˆå¤šä¸ªå‚æ•°ï¼Œä½†ä»£ç æ‰§è¡Œçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼

å¦‚ï¼š

``` js
function func(x, y) {
  console.log(this, x, y);
}

func.call("call: ", 1, 2); // -> StringÂ {"call: "} 1 2

// func.apply("apply: ", 1,2); // -> å¦‚æœä½ è¿™æ ·ä¼ ï¼Œä¼šæŠ¥ã€ŒUncaught TypeError: CreateListFromArrayLike called on non-objectã€è¿™æ ·çš„é”™è¯¯

func.apply("apply: ", [1, 2]); // -> StringÂ {"apply: "} 1 2
```

### â—‡bind

> `call/apply` éƒ½æ˜¯æ”¹å˜thisçš„åŒæ—¶ç›´æ¥æŠŠå‡½æ•°æ‰§è¡Œäº†ï¼Œè€Œbindä¸æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå±äºé¢„å…ˆæ”¹å˜thiså’Œä¼ é€’ä¸€äº›å†…å®¹ -> "æŸ¯ç†åŒ–"ï¼ˆå¤§å‡½æ•°é‡Œè¾¹è¿”å›å°å‡½æ•°ï¼Œè¯¥å°å‡½æ•°ä¾›å¤–è¾¹ä½¿ç”¨ï¼‰

ä¸ºä»€ä¹ˆéœ€è¦bindï¼Ÿ

æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š

``` js
let obj = {
  fn(x, y) {
    console.log(this, x, y);
  },
};
setTimeout(obj.fn, 1000, 1, 2);
```

æˆ‘ä»¬è¦ç¡®å®š `obj.fn` çš„ `this` æŒ‡å‘ä¸º `obj` ï¼Œè€Œä¸æ˜¯ `window` 

é‚£ä¹ˆæˆ‘ä»¬å°±ä¸èƒ½ç”¨ `call` å’Œ `apply` äº†ï¼Œæ¯•ç«Ÿå®ƒä»¬ä¿©æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¾—ç”¨ä¸Š `bind` äº†ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦ä¸ºå®šæ—¶å™¨è¿½åŠ å‚æ•°äº†â€¦â€¦

å› æ­¤ï¼Œå¯æœ‰ï¼š

``` js
setTimeout(obj.fn.bind(obj, 1, 2), 1000);
```

---

Qï¼šé‡å†™bindï¼Ÿ

``` js
~(function anonymous(proto) {
  function bind(context) {
    // context may be null or undefined
    // ä¸ºå•¥ä¸è¿™æ ·å†™ context = context || windowï¼Ÿ -> å¦‚æœä¼ çš„æ˜¯''å’Œ0ç­‰è¿™æ ·çš„falsyå€¼å‘¢ï¼Ÿ
    if (context == undefined) {
      context = window;
    }
    // è·å–ä¼ é€’çš„å®å‚é›†åˆ
    // è¿™ç®—æ˜¯ä¸€ä¸ªå°æŠ€å·§å§ï¼Œå¯è°“æ–¹æ³•å€Ÿç”¨â€¦â€¦å½“ç„¶è¿™å¯ä¸æ˜¯éšæ„å€Ÿç”¨çš„ï¼Œä½ è¿™argumentså¯ç¬¦åˆæŸç§æ•°æ®ç»“æ„æ‰è¡Œï¼Œå¦‚å¯éå†çš„â€¦â€¦
    var args = [].slice.call(arguments, 1);
    // éœ€è¦æœ€ç»ˆæ‰§è¡Œçš„å‡½æ•° -> é‚£ä¸ªcallback
    var _this = this;
    return function anonymous() {
      // ä¸ºå•¥è¦æœ‰è¿™è¡Œä»£ç å‘¢ï¼Ÿ -> å› ä¸ºè¿”å›çš„è¿™ä¸ªå‡½æ•°æœ‰å¯èƒ½è¢«ä¼ å…¥å‚æ•°ï¼Œå¦‚äº‹ä»¶å¯¹è±¡ï¼š
      // document.body.onclick = obj.fn.bind(window, 10, 20)
      // document.body.onclick = anonymous -> æµè§ˆå™¨ä¼šä¼ ä¸ªäº‹ä»¶å¯¹è±¡ç»™è¿™ä¸ªanonymousï¼Œæ‰€ä»¥ä½ å¾—æ‰¾ä¸ªå®¹å™¨æ¥æ”¶ä¸€ä¸‹
      var amArg = [].slice.call(arguments, 0);

      // ä¸ºå•¥è¦ç”¨applyï¼Ÿ -> å› ä¸ºargsæ˜¯ä¸ªæ•°ç»„å“ˆï¼ä¸€èˆ¬éƒ½ä¼šæŠŠåƒevè¿™æ ·çš„å†…ç½®å‚æ•°æ‰”åˆ°æ•°ç»„çš„æœ€åï¼ŒçœŸæ­£çš„bindæºç ä¹Ÿæ˜¯è¿™æ ·å†™çš„â€¦â€¦
      _this.apply(context, args.concat(amArg));
    };
  }
  proto.bind = bind;
})(Function.prototype);
```

> å¦‚æœä½ ä¸è€ƒè™‘å†…éƒ¨ä¼ å‚çš„è¯ï¼Œå…¶å®è¿™bindçš„å†™æ³•è¿˜å¯ä»¥æ›´ç®€å•â€¦â€¦å³å°å‡½æ•°ä¸ç”¨æä¸ª`amArg`å“ˆï¼

ä»£ç æµ‹è¯•ï¼š

``` js
let obj = {
  fn(...args) {
    console.log(this, args);
  },
};
setTimeout(obj.fn, 1000, 1, 2);
setTimeout(obj.fn.bind(obj, 1, 2), 1000);
document.body.onclick = obj.fn.bind(obj, 1, 2);
```

ç»“æœï¼š

![bindé‡å†™å§¿åŠ¿ä¸€](assets/img/2020-06-13-14-34-18.png)


