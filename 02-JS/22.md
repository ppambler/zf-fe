| âœï¸ Tangxt | â³ 2020-06-15 | ğŸ·ï¸ JS ä¸“é¢˜ |

# 22-ç»¼åˆä¸“é¢˜ä¹‹æ£€æµ‹æ•°æ®ç±»å‹çš„å››ç§æ–¹æ¡ˆ1

## â˜…æ¦‚è¿°

* typeof
* instanceof
* constructor
* Object.prototype.toString.call

## â˜…ç¬¬ä¸€ç§æ•°æ®ç±»å‹æ£€æµ‹æ–¹å¼â€”â€”typeof

* è¿”å›çš„ç»“æœéƒ½æ˜¯å­—ç¬¦ä¸²ï¼š
  + å­—ç¬¦ä¸²ä¸­åŒ…å«äº†å¯¹åº”çš„æ•°æ®ç±»å‹  "number"/"string"/"boolean"/"undefined"/"symbol"/"object"/"function"
* å±€é™æ€§ï¼š
  + `typeof null` -> `"object"` -> nullä¸æ˜¯å¯¹è±¡ï¼Œå®ƒæ˜¯ç©ºå¯¹è±¡æŒ‡é’ˆï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨å®Œäº†ä¸€ä¸ªå¯¹è±¡å˜é‡ï¼Œå°±ä¼šæŠŠè¯¥å¯¹è±¡èµ‹å€¼ä¸º `null` ï¼Œå°±ç›®å‰çš„Chromeæµè§ˆå™¨è€Œè¨€ï¼Œå®ƒæ—¶ä¸æ—¶å°±ä¼šå»å›æ”¶å’©æœ‰è¢«å ç”¨çš„å †å†…å­˜ï¼Œå¦‚æœ¬æ¥ä¸€ä¸ª `obj` å˜é‡ï¼Œå ç”¨äº† `{name:'frank'}` è¿™ä¸ªå †å†…å­˜ï¼Œæˆ‘ä»¬ç”¨å®Œäº†è¿™ä¸ªå †å†…å­˜ï¼Œæˆ‘ä»¬å°± `obj = null` ï¼Œè¿™æ ·ä¸€æ¥ `{name:'frank'}` å°±å’©æœ‰è¢« `obj` å ç”¨äº†ï¼Œæ²¡æœ‰è¢«å ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè¢«Chromeæµè§ˆå™¨çš„è¾£é¸¡å›æ”¶æœºåˆ¶ç»™å›æ”¶æ‰ï¼ -> IEçš„è¾£é¸¡å›æ”¶æœºåˆ¶ä¸chromeä¸åŒ
  + æ£€æµ‹æ•°ç»„æˆ–è€…æ­£åˆ™ç­‰ç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¿”å›ç»“æœéƒ½æ˜¯"object"ï¼Œæ‰€ä»¥æ— æ³•åŸºäºtypeofåˆ¤æ–­è¿™å˜é‡çš„å€¼æ˜¯æ•°ç»„è¿˜æ˜¯æ­£åˆ™
* ä½•æ—¶ç”¨ï¼Ÿ
  + æ£€æµ‹åŸºæœ¬çš„æ•°æ®ç±»å‹å¯ä»¥ç”¨ä¸€ä¸‹ï¼Œä½†å¯¹äºæ£€æµ‹ç»†åˆ†è¿‡åçš„å¯¹è±¡å€¼ï¼Œå°±æ— èƒ½æ— åŠ›äº†ï¼ -> æ‰€ä»¥è¿™å°±æ˜¯ä¸ºå•¥è¿˜æœ‰å…¶å®ƒæ•°æ®ç±»å‹æ£€æµ‹æ–¹å¼çš„åŸå› æ‰€åœ¨äº†ï¼Œä¸ç„¶å¦‚æœä½  `typeof` å¾ˆå¼ºå¤§çš„è¯ï¼Œå°±ä¸éœ€è€ƒè™‘å…¶å®ƒæ£€æµ‹æ–¹å¼äº†

é¢è¯•çš„å‘ï¼ˆä¹Ÿä¸ç®—æ˜¯å‘ï¼‰ï¼š

``` js
console.log(typeof []); // => "object"
console.log(typeof typeof []); // => "string"
```

> è¿ç®—è§„åˆ™æ˜¯ï¼šä»å³å¾€å·¦ï¼

## â˜…ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ•°æ®ç±»å‹æ£€æµ‹æ–¹å¼â€”â€”`instanceof`/`constructor`

### â—‡instanceof

* æ£€æµ‹æŸä¸ªå®ä¾‹æ˜¯å¦å±äºè¿™ä¸ªç±»
* å®ƒæ£€æµ‹çš„åº•å±‚æœºåˆ¶ï¼šæ‰€æœ‰å‡ºç°åœ¨å…¶åŸå‹é“¾ä¸Šçš„ç±»ï¼Œæ£€æµ‹ç»“æœéƒ½æ˜¯TRUE
* å±€é™æ€§ï¼š
  + ç”±äºå¯ä»¥åŸºäº `__proto__` æˆ–è€… `prototype` æ”¹åŠ¨åŸå‹é“¾çš„åŠ¨å‘ï¼Œæ‰€ä»¥åŸºäº `instanceof` æ£€æµ‹å‡ºæ¥çš„ç»“æœå¹¶ä¸ä¸€å®šæ˜¯å‡†ç¡®çš„
  + åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œè¿å¯¹è±¡éƒ½ä¸æ˜¯ï¼Œæ›´æ²¡æœ‰ `__proto__` ï¼Œè™½è¯´ä¹Ÿæ˜¯æ‰€å±ç±»çš„å®ä¾‹ï¼Œåœ¨JSä¸­ä¹Ÿå¯ä»¥è°ƒå–æ‰€å±ç±»åŸå‹ä¸Šçš„æ–¹æ³•ï¼Œä½†æ˜¯instanceofæ˜¯ä¸è®¤çš„

æµ‹è¯•ï¼š

``` js
console.log(12 instanceof Number); // => false
console.log(new Number(12) instanceof Number); // => true
console.log([] instanceof Array); // => true
console.log([] instanceof Object); // => true
```

> å…³äºæµè§ˆå™¨çš„éšå¼è½¬æ¢ï¼š `(12).__proto__` <=> `new Number(12).__proto__` 

å¯ä»¥çœ‹åˆ° `12` æ˜æ˜æ˜¯Numberçš„å®ä¾‹ï¼Œä½†æ˜¯ `instanceof` å°±æ˜¯ä¸è®¤

æå `instanceof` çš„æµ‹è¯•ï¼š

``` js
let arr = []

function fn() {}
arr.__proto__ = fn.prototype
arr instanceof Array // -> false
```

![instanceof](assets/img/2020-06-15-19-35-52.png)

å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡JSï¼ŒåŸå‹é“¾åŸºäº `__proto__` æˆ–è€… `prototype` æ˜¯å¯ä»¥éšæ„æ”¹åŠ¨çš„ï¼Œå› æ­¤ï¼Œ `instanceof` æ£€æµ‹å‡ºæ¥çš„ç»“æœå¹¶ä¸ä¸€å®šå‡†ç¡®ï¼ -> æ‰€ä»¥ `instanceof` åªèƒ½ç”¨ä½œäºä¸€ä¸ªç®€å•çš„å‚è€ƒå§¿åŠ¿ï¼

å°ç»“ï¼š

* æ— æ³•ç”¨ `instanceof` æ£€æµ‹åŸºæœ¬ç±»å‹ï¼Œè€Œ `typeof` åˆ™å¯ä»¥ -> `instanceof` æ£€æµ‹å¼•ç”¨ç±»å‹å€¼è¦æ¯” `typeof` å‡†ç¡®ç‚¹ï¼å¦‚ `/^$/ instanceof RegExp -> true` 

### â—‡constructor

åŒ `instanceof` åŸºæœ¬ä¸€æ ·

``` js
// ç§æœ‰constructorå±æ€§æ‰¾ä¸åˆ°å°±æ‰¾å…¬æœ‰çš„
console.log([].constructor === Array) // -> true -> è¡¨ç¤º [] ä¸ºæ•°ç»„
console.log([].constructor === Object) // -> false -> ä¸å¯è·¨çº§
console.log(({}).constructor === Array) // -> false
console.log((12).constructor === Number) // -> true
```

`constructor` è¿™ä¸ªå€¼ä¹Ÿæ˜¯å¯ä»¥éšä¾¿æ”¹çš„ï¼Œè€Œä¸”æ¯” `instanceof` è¿˜è¦æ›´æ¶å¿ƒï¼å¦‚ï¼š

``` js
let arr = []
Array.prototype.constructor = null
arr.constructor === Array // -> false
```

å‡¡æ˜¯å¯ä»¥éšä¾¿æ”¹çš„ï¼Œéƒ½æ˜¯ä¸ä¸¥è°¨çš„ï¼Œæˆ–å¤šæˆ–å°‘ä¼šå‡ºç°æ½œåœ¨çš„bugï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åŸºæœ¬éƒ½ä¸ä¼šå»åŠ¨ `constructor` çš„æŒ‡å‘ï¼Œæˆ–è€…æ˜¯åŸå‹é“¾çš„æŒ‡å‘â€¦â€¦

æ€»ä¹‹ï¼Œå¯¹äºåŸºæœ¬ç±»å‹è€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥ç”¨ `constructor` æ¥æçš„ï¼ -> ç®€å•å‚è€ƒç”¨ `constructor` å’Œ `instanceof` è¿™ä¸¤ä¸ªä¸œè¥¿å§ï¼

---

å°±ä¸Šè¾¹æˆ‘ä»¬æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œä¸ç®¡æ˜¯ `typeof` ã€ `instanceof` ï¼Œè¿˜æ˜¯ `constructor` ï¼Œéƒ½æœ‰è‡ªå·±å¾ˆå¤šçš„å±€é™æ€§

é‚£ä¹ˆæ˜¯å¦å­˜åœ¨ä¸€ç§æ²¡æœ‰å±€é™æ€§çš„æ–¹æ¡ˆå‘¢ï¼Ÿ

æœ‰çš„ï¼Œé‚£å°±æ˜¯ `Object.prototype.toString` æ–¹æ³•å•¦ï¼ -> æ³¨æ„ï¼Œè¿™æ˜¯ObjectåŸå‹ä¸Šçš„ `toString` æ–¹æ³•ï¼å¯ä¸æ˜¯å…¶å®ƒç±»ï¼ˆå¦‚Arrayç­‰ï¼‰ä¸Šçš„ `toString` æ–¹æ³•ï¼

## â˜…ç¬¬å››ç§æ•°æ®ç±»å‹æ£€æµ‹æ–¹å¼â€”â€”`Object.prototype.toString.call`

> æ²¡æœ‰å±€é™æ€§çš„æ–¹æ¡ˆï¼

### â—‡æ¦‚è¿°

* Number/String/Boolean/Symbolå®ƒä»¬çš„åŸå‹ä¸Šéƒ½æœ‰ï¼š
  + toStringï¼šè½¬åŒ–ä¸ºå­—ç¬¦ä¸²
  + valueOfï¼šè¿”å›åŸå§‹å€¼ï¼ˆä¹Ÿå°±æ˜¯æ‰€è°“çš„åŸºæœ¬ç±»å‹å€¼ï¼‰
* Array/RegExp/Functionç­‰å†…ç½®ç±»çš„åŸå‹ä¸Šéƒ½æœ‰
  + toStringï¼šè½¬åŒ–ä¸ºå­—ç¬¦ä¸²
* Objectçš„åŸå‹ä¸Š
  + toStringï¼š**è¿”å›å½“å‰å®ä¾‹æ‰€å±ç±»çš„ä¿¡æ¯**
  + valueOfï¼šè¿”å›åŸå§‹å€¼

æ³¨æ„ï¼Œä¹Ÿæ˜¯æœ‰ `Null` å’Œ `Undefined` è¿™ä¸¤ä¸ªå†…ç½®ç±»çš„ï¼Œåªæ˜¯æˆ‘ä»¬å¼€å‘è€…æ— æ³•ä½¿ç”¨ç½¢äº† -> ä½ ä¸€ä½¿ç”¨å°±ä¼šæŠ¥é”™ï¼

æ•²é»‘æ¿ï¼š

> ObjectåŸå‹ä¸Šçš„ `toString` æ–¹æ³•å¯**ä¸æ˜¯ç”¨æ¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ï¼Œè€Œæ˜¯è¿”å›å½“å‰å®ä¾‹æ‰€å±ç±»çš„ä¿¡æ¯**

![toStringè¿”å›å›ºå®šæ ¼å¼çš„å€¼](assets/img/2020-06-16-13-39-49.png)

### â—‡ä½¿ç”¨

å†™æ³•ï¼ˆæœ¬è´¨ä¸Šæ˜¯å…¶å®ƒç±»å‹æ•°æ®çš„æ–¹æ³•å€Ÿç”¨ï¼Œå°±åƒæ˜¯ä¼ªæ•°ç»„ï¼Œå¦‚argumentså€Ÿç”¨æ•°ç»„çš„sliceæ–¹æ³•å˜ä¸ºçœŸæ­£çš„æ•°ç»„ï¼‰ï¼š

``` js
Object.prototype.toString.call([value])

// or

({}).toString.call([value])
```

è¿”å›å€¼çš„æ ¼å¼ï¼š

``` js
"[object æ‰€å±ç±»ä¿¡æ¯]"
```

å¯èƒ½æœ‰çš„ç»“æœï¼š

``` js
"[object Object/Array/RegExp/Date/Function/Null/Undefined/Number/String/Boolean/Symbol...]"
```

åŸç†ï¼š

![æ–¹æ³•å€Ÿç”¨åŸç†](assets/img/2020-06-16-13-49-54.png)

> æ•°ç»„å­—é¢é‡ä¸éœ€è¦è¿™æ · `([])` ï¼Œè€Œæ™®é€šå¯¹è±¡æ˜¯éœ€è¦çš„ -> `({})` ï¼Œå› ä¸º `{}` åœ¨JSä¸­æœ‰å¤ªå¤šå«ä¹‰äº†ï¼Œå¦‚ä»£ç å—ï¼Œå¯¹è±¡å­—é¢é‡ç­‰ç­‰ï¼Œæ‰€ä»¥å¦‚æœä½ è¿™æ · `{}.toString()` ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼

æµ‹è¯•ï¼ˆæ£€æµ‹å„ç§å€¼çš„æ•°æ®ç±»å‹ï¼‰ï¼š

![æ£€æµ‹å„ç§å€¼çš„æ•°æ®ç±»å‹](assets/img/2020-06-16-14-11-31.png)

å³ä¾¿ä½ æ›´æ”¹åŸå‹æˆ–åŸå‹é“¾ï¼š

![æ”¹åŸå‹](assets/img/2020-06-16-14-19-29.png)

ä¹Ÿä¸ä¼šå½±å“ `({}).toString.call()` çš„åˆ¤æ–­ï¼

æ‰€ä»¥ï¼š

> è¿™ç§æ–¹å¼åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå±€é™æ€§ï¼Œæ˜¯æ£€æµ‹æ•°æ®ç±»å‹æœ€å‡†ç¡®çš„æ–¹å¼

ä½†åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™è¿˜æ˜¯æœ‰å¼Šç«¯çš„ï¼š

![ä¹Ÿæ˜¯æœ‰å¼Šç«¯çš„toStringæ–¹æ³•](assets/img/2020-06-16-14-25-03.png)

---

## â˜…æ€»ç»“

* JSæ£€æµ‹æ•°æ®ç±»å‹çš„å››ç§æ–¹å¼ï¼Œéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹å’Œå„è‡ªçš„å±€é™æ€§
* åœ¨çœŸå®é¡¹ç›®é‡Œè¾¹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå·±æ¥æ£€æµ‹æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€èˆ¬çš„å§¿åŠ¿æ˜¯è¿™æ ·çš„ï¼š
  + åŸºæœ¬æ•°æ®ç±»å‹æ£€æµ‹ -> åŸºæœ¬ä¸Šç”¨ `typeof` -> ä¸ºå•¥ç”¨è¿™ä¸ªï¼Ÿ -> å› ä¸ºç®€å•å‘€ï¼æ²¡å¿…è¦æé‚£äº›å¤æ‚çš„å§¿åŠ¿
  + å¯¹äºå¼•ç”¨ç±»å‹çš„æ£€æµ‹ï¼Œå¦‚æˆ‘ä»¬è¦æ£€æµ‹ä¸€ä¸‹è¿™ä¸ªå¼•ç”¨ç±»å‹å€¼æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œå¥½åŒºåˆ†å®ƒä¸æ˜¯ä¸€ä¸ª `{}` ï¼š
    - ä¸ä¸¥è°¨æƒ…å†µä¸‹ï¼šã€Œä¸€ä¸ª `instanceof` å°±æå®šï¼Œå¦‚ `xxx instanceof Array` ã€ï¼Œæˆ–è€…å¦ä¸€ç§å§¿åŠ¿ï¼š `xxx.constructor === Array` 
    - ä¸¥è°¨æƒ…å†µä¸‹ï¼šå°±ç”¨ `({}).toString.call(xxx)` è¿™ç§å§¿åŠ¿æ¥æï¼
* åŠ æ·±äº†æˆ‘å¯¹æ•°æ®æ˜¯æœ‰ç±»å‹ä¹‹åˆ†çš„è®¤è¯†ï¼Œå¦‚æˆ‘çœ‹åˆ°ä¸€ä¸ªæ•°å­— `1` ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ `Number` ç±»å‹çš„ -> æˆ‘çœ‹åˆ° `/^$/` è¿™ç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ `RegExp` ç±»å‹çš„ -> æˆ‘çœ‹åˆ° `[]` è¿™ç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ `Array` ç±»å‹çš„ -> æˆ‘çœ‹åˆ° `{}` è¿™ç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ `Object` ç±»å‹çš„ -> æˆ‘çœ‹åˆ° `function(){}` è¿™ç§ç»“æ„çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ `Function` ç±»å‹çš„ -> â€¦â€¦

## â˜…Q&A

1ï¼‰BigIntï¼Ÿ

â¹ï¼š[JSæœ€æ–°åŸºæœ¬æ•°æ®ç±»å‹ï¼šBigInt - æ˜é‡‘](https://juejin.im/post/5d3f8402f265da039e129574#heading-5)
