| âœï¸ Tangxt | â³ 2020-07-03 | ğŸ·ï¸ DOM æ“ä½œ |

# 33-DOMæ“ä½œ-è·å–å…ƒç´ çš„æ ·å¼ï¼ˆgetComputedStyleï¼‰

## â˜…å‰è¨€

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨äº†è§£è¿™13ä¸ªå±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¸ºäº†ã€Œ**è·å–åˆ°å½“å‰å…ƒç´ çš„æ ·å¼ä¿¡æ¯**ã€ï¼Œæ¯•ç«Ÿ `[ELEMENT].style.xxx` åªèƒ½æ‹¿åˆ°å†™åœ¨å…ƒç´ èº«ä¸Šçš„æ ·å¼ï¼

æˆ‘ä»¬ä»¥ä¸ºäº†è§£äº†è¿™13ä¸ªå±æ€§å°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œç„¶è€Œï¼Œé€šè¿‡è¿™13ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¤§å¤šæ‹¿åˆ°çš„éƒ½æ˜¯ã€Œ**ç»„åˆå€¼**ã€ï¼Œå³å¦‚ `clientWidth = contentWidth + paddingLeft/Right` ï¼Œè€Œè¿™å¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„ç›®çš„ï¼Œå³ã€Œ**æˆ‘ä»¬æƒ³è¦çš„æ˜¯å…ƒç´ çš„å…·ä½“çš„æŸä¸ªæ ·å¼å€¼**ã€

é‚£ä¹ˆæ˜¯å¦å­˜åœ¨æŸç§å§¿åŠ¿å¯ä»¥æ‹¿åˆ°å…·ä½“çš„æŸä¸ªæ ·å¼å€¼å‘¢ï¼Ÿå¦‚æˆ‘æƒ³æ‹¿åˆ° `xxx` å…ƒç´ çš„ `border` å€¼ï¼Œæˆ‘æƒ³æ‹¿åˆ° `xxx` å…ƒç´ çš„ `width` å€¼â€¦â€¦

> æœ‰çš„ï¼Œé‚£å°±æ˜¯é€šè¿‡ `getComputedStyle` è¿™ä¸ªæ–¹æ³•æ¥çœŸæ­£è·å–å…ƒç´ æ ·å¼â€¦â€¦

## â˜… `getComputedStyle`

### â—‡æ¦‚è¿°

#### <mark>1ã€æ˜¯ä»€ä¹ˆï¼Ÿ</mark>

`getComputedStyle` æ˜¯è·å–å½“å‰å…ƒç´ æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—è¿‡çš„æ ·å¼ -> `Computed` ï¼ˆè¢«è®¡ç®—è¿‡çš„ï¼‰

#### <mark>2ã€æœ‰å•¥ç‰¹å¾ï¼Ÿ</mark>

* åªè¦å…ƒç´ åœ¨é¡µé¢ä¸­å‘ˆç°å‡ºæ¥ï¼Œé‚£ä¹ˆ**æ‰€æœ‰çš„æ ·å¼éƒ½æ˜¯ç»è¿‡æµè§ˆå™¨è®¡ç®—çš„** -> ä½ æ‰€çœ‹åˆ°çš„é¡µé¢æ ·å¼éƒ½æ˜¯ç»è¿‡æµè§ˆå™¨è®¡ç®—å‡ºæ¥çš„ï¼Œè€Œè®¡ç®—å‡ºæ¥çš„æ ·å¼ï¼Œå¾ˆæœ‰å¯èƒ½æ²¡æœ‰å¯¹åº”ä¸Šæˆ‘ä»¬å¼€å‘è€…æ‰€å†™çš„æ ·å¼â€¦â€¦
* å“ªæ€•ä½ æ²¡æœ‰è®¾ç½®ã€æ²¡æœ‰è§è¿‡çš„æ ·å¼ä¹Ÿéƒ½è®¡ç®—äº† -> æµè§ˆå™¨å†…ç½®çš„æ ·å¼ä¹Ÿèƒ½è·å–åˆ°
* ä¸ç®¡ä½ å†™æˆ–è€…ä¸å†™ï¼Œä¹Ÿä¸è®ºå†™åœ¨å“ªï¼Œæ ·å¼éƒ½åœ¨è¿™ï¼Œå¯ä»¥ç›´æ¥è·å– -> ä¸ç®¡ä½ å†™åœ¨å…ƒç´ ä¸Šï¼Ÿå†™åœ¨ `style` æ ‡ç­¾é‡Œè¾¹ï¼Ÿå†™åœ¨ `css` æ–‡ä»¶é‡Œè¾¹ï¼Ÿéƒ½èƒ½è·å–

> è¿™ä¸ªæ–¹æ³•ç»™äººçš„æ„Ÿè§‰ -> å¾ˆå¼ºå¤§ï¼

#### <mark>3ã€å…¼å®¹æ€§ï¼Ÿ</mark>

åœ¨IE6~8æµè§ˆå™¨ä¸­ä¸å…¼å®¹ï¼Œéœ€è¦åŸºäº `currentStyle` æ¥è·å–

> IEä½ è‡ªå°½å§ï¼éƒ½2020å¹´ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘å…¼å®¹ä½ ï¼Ÿ -> ä¸ä¸ï¼Œé”™çš„ä¸æ˜¯IEï¼Œé”™çš„æ˜¯é‚£äº›æµåœ¨IEæ—¶ä»£çš„å¤è€é¡¹ç›®â€¦â€¦ -> è¿™äº›é¡¹ç›®åäº†ï¼Œè¿˜è¦æˆ‘ä»¬æ–°æ—¶ä»£çš„å¼€å‘è€…ç”¨å¤è€çš„é›¶ä»¶å»ä¿®ï¼ŒçœŸæ˜¯é†‰äº†â€¦â€¦

#### <mark>4ã€è¯­æ³•ï¼Ÿ</mark>

``` js
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ“ä½œçš„å…ƒç´   ç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒç´ çš„ä¼ªç±»:after/:beforeï¼Œå‡å¦‚ä¼ªå…ƒç´ æ˜¯ ::after ï¼Œæ ·å¼å†™çš„æ˜¯ h3::afterï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå‚æ•°å°±å¾—æ˜¯ä¼ªç±» :after è¿™ç§å†™æ³•
var style = window.getComputedStyle(element[, pseudoElt]);
```

`element` æ˜¯ä¸ªDOMå…ƒç´ å¯¹è±¡å“ˆï¼ -> ç¬¬äºŒä¸ªå‚æ•°ä¸å†™æˆ–å†™ `null` æˆ–å†™åƒ `:after` è¿™æ ·çš„ä¼ªç±»

è¿”å›å€¼æ˜¯ä¸€ä¸ª `CSSStyleDeclaration` å®ä¾‹ -> ä½ å¯ä»¥çœ‹åˆ°è¯¥å®ä¾‹çš„ `__proto__` æŒ‡å‘çš„å°±æ˜¯ `CSSStyleDeclaration.prototype` ï¼Œå³ï¼š

``` js
window.getComputedStyle(box).__proto__ === CSSStyleDeclaration.prototype // -> true
```

æµ‹è¯•ï¼š

![æµ‹è¯•](assets/img/2020-07-04-16-10-40.png)

åœ¨ `getComputedStyle(box)` çš„è¿”å›å€¼é‡Œè¾¹ï¼Œæœ‰å“ªäº›ä¿¡æ¯ä¼šç»™äºˆæˆ‘ä»¬ä¸€äº›å¯ç¤ºå‘¢ï¼Ÿ

å¦‚ï¼š

`animation: "none 0s ease 0s 1 normal none running"` -> åŠ¨ç”»å±æ€§çš„é»˜è®¤å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯éåŒ€é€Ÿçš„ï¼Œå³æ˜¯ `ease` çš„ï¼

![animationé»˜è®¤å€¼](assets/img/2020-07-04-16-18-02.png)

æ€»ä¹‹ï¼š

`window.getComputedStyle(box)` æ‹¿åˆ°çš„ç»“æœæ˜¯ `CSSStyleDeclaration` è¿™ä¸ªç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ -> **åŒ…å«äº†å½“å‰å…ƒç´ æ‰€æœ‰çš„æ ·å¼ä¿¡æ¯**

#### <mark>5ã€ä½¿ç”¨</mark>

``` js
let styleObj = window.getComputedStyle(box);
styleObj["width"] // -> "300px"
styleObj["height"] // -> "300px"
styleObj["backgroundColor"] // -> "rgba(0, 0, 0, 0)"
styleObj.display // -> "block"

// IE6~8 -> å…¼å®¹æ€§å¤„ç†
// styleObj = [element].currentStyle;
styleObj = box.currentStyle;
```

ä»¥ä¸Šå°±æ˜¯è·å–å…ƒç´ æ ·å¼çš„æœ€ä¼˜æ–¹æ¡ˆäº†

## â˜…äº†è§£æ›´å¤š

â¹ï¼š[Window.getComputedStyle() - Web APIs - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)

â¹ï¼š[-webkit-animation - CtripUED Webkit CSS Library](http://ic4.github.io/webkitcss/prop/animation.html)

## â˜…æ€»ç»“

* JS DOM æ“ä½œ -> è®°ä¸‹ä»¥ä¸‹è¿™äº›å†…å®¹ï¼Œå¯¹JSçš„DOMæ“ä½œçš„è®¤è¯†ä¹Ÿå°±å·®ä¸å¤šäº†â€¦â€¦
  + è·å–DOMå…ƒç´ çš„é‚£å‡ ç§å§¿åŠ¿
  + å¯¹DOMå…ƒç´ åŠ¨æ€çš„å¢åˆ æ”¹ã€è‡ªå®šä¹‰DOMå…ƒç´ çš„å±æ€§ï¼ˆæ·»åŠ  or ç§»é™¤ï¼‰
  + è·å–æˆ–æ›´æ”¹å…ƒç´ çš„æ ·å¼
    - `xxx.style.width`
    - é€‚ç”¨äºç‰¹æ®Šåœºæ™¯ä¸‹çš„13ä¸ªJSç›’å­æ¨¡å‹å±æ€§
    - ä¸€ç½‘æ‰“å°½çš„ `getComputedStyle(box)`
* åœ¨çœŸå®é¡¹ç›®é‡Œè¾¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Vue` ã€ `React` ç­‰è¿™äº›æ¡†æ¶ï¼Œå¼±åŒ–äº†æˆ‘ä»¬DOMæ“ä½œè¿™ä¸ªç¯èŠ‚ï¼Œæ‰€ä»¥å°±æ²¡æœ‰è®²ä¸€äº›å°è£…DOMæ“ä½œçš„æ–¹æ³• -> ä¸ç®¡æ€æ ·ï¼ŒDOMæ“ä½œçš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å»äº†è§£çš„
* åœ¨DOMé‡Œè¾¹ï¼Œæˆ‘ä»¬å¾—çŸ¥é“å“ªä¸ªå±æ€§å“ªä¸ªæ–¹æ³•çš„å…¼å®¹æ€§æ˜¯æ€æ ·çš„ï¼Œæ¯•ç«ŸDOMæ˜¯å­˜åœ¨å…¼å®¹æ€§çš„ï¼

## â˜…Q&A

### <mark>1ï¼‰æˆ‘ä¿®æ”¹github issues é‡Œè¾¹çš„æ ·å¼ï¼Œå‘ç°ç”¨ `getComputedStyle` å»è®¾ç½®æ ·å¼æŠ¥é”™äº†ï¼Ÿ</mark>

![æ ·å¼æŠ¥é”™](assets/img/2020-07-05-17-30-07.png)

You aren't allowed to write to the styles returned by getComputedStyle if they were computed by the browser (ie not set by JavaScript already or by a CSS file).

Instead of `list.setProperty('opacity', '0')` , use `scrollList.style.opacity = "0"` or add an opacity rule to the `.list` selector in your CSS.

ç®€å•æ¥è¯´ï¼Œä¸æ˜¯è¡Œå†…ã€å†…éƒ¨ã€å¤–éƒ¨æ‰€è®¾ç½®çš„æ ·å¼ï¼Œæˆ‘ä»¬éƒ½æ— æ³•é€šè¿‡ `getComputedStyle` æ¥æ”¹ï¼

æ‰€ä»¥æˆ‘æµ‹è¯•ä¸€ä¸‹çœ‹çœ‹ç”¨ `xxx.style.color` æ¥æ”¹è¡Œä¸è¡Œï¼Ÿç»“æœå‘ç°è¿™æ˜¯å¯ä»¥çš„ï¼

æœ€ç»ˆç»“æœï¼š

``` js
const style = {
  color: '#ec4863',
  fontSize: '20px'
}
// æŠŠstyleææˆæ˜¯ 'width:18px;height:48px;'è¿™æ ·çš„æ ¼å¼'
// ä¸éœ€è¦æå–å¼•å·é‡Œè¾¹çš„å†…å®¹ï¼Œå¦‚'hi' -> hiï¼Œå­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œè¾¹çš„è¡¨ç¤ºå°±æ˜¯ 'hi'

let styleText = ''

for (var k in style) {
  styleText += `${k}:${style[k]};`
}

console.log(styleText)

let strongEle = document.querySelectorAll('p > strong');
for (let i = 0; i < strongEle.length; i++) {
  for (let k in style) {
    strongEle[i].style[k] = style[k]
  }
}
```

> `cssText` å¾ˆé¸¡è‚‹å‘€ï¼

â¹ï¼š[javascript - Failed to execute 'setProperty' on 'CSSStyleDeclaration': These styles are computed, and therefore the 'opacity' property is read-only - Stack Overflow](https://stackoverflow.com/questions/60510438/failed-to-execute-setproperty-on-cssstyledeclaration-these-styles-are-compu)
