| âœï¸ Tangxt | â³ 2020-08-05 | ðŸ·ï¸ è®¾è®¡æ¨¡å¼ |

# 37-å‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼

## â˜…å‰è¨€

ä»ŽæœåŠ¡å™¨èŽ·å–æ•°æ®ï¼š

1. æ•°æ®åˆ†æž
2. æ•°æ®ç»‘å®š
3. DOM å…ƒç´ çš„ç›¸å…³æ“ä½œ
4. â€¦â€¦

å…ƒç´ ç›‘å¬ç”¨æˆ·è¡Œä¸ºï¼š

1. æŽ¥æ”¶åˆ°äº†ä¿¡å·
2. ä¿¡å·åˆ†æž
3. æ‰§è¡Œ callback
4. æ•°æ®ç»‘å®š
5. DOM å…ƒç´ çš„ç›¸å…³æ“ä½œ
6. â€¦â€¦

## â˜…æ˜¯ä»€ä¹ˆï¼Ÿ

1ï¼‰æ¦‚è¿°

> é€è¿‡äº‹ä»¶æ± æœºåˆ¶ï¼Œæ¥è®©ä½ äº†è§£ä»€ä¹ˆæ˜¯ã€Œå‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼ã€

æˆ‘ä»¬ä½¿ç”¨ jQuery çš„ ajax æ–¹æ³•ï¼Œæ¥å‘é€ ajax è¯·æ±‚ï¼š

``` js
$.ajax({
  url: '/api/v1/userlist',
  success: function(result) {
    fn1(result)
    fn2(result)
    fn3(result)
  }
})

function fn1() {}

function fn2() {}

function fn3() {}
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ axiosï¼š

``` js
axios.get('/api/v1/userlist')
.then(res => {})
.catch((err) => {})
```

ä¹Ÿå¯ä»¥ä½¿ç”¨å‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼ï¼š

å…ˆè§„åˆ’å¥½æ‹¿åˆ°æ•°æ®ä¹‹åŽï¼Œåº”è¯¥è¦åšä»€ä¹ˆï¼š

æŠŠ callback æ‰”åˆ°ä¸€ä¸ªå®¹å™¨é‡Œè¾¹åŽ» -> `$on(fn1)`ã€`$on(fn2)` -> ä¹Ÿå¯ä»¥ç§»é™¤ callbackï¼ˆ`$off`ï¼‰

æ•°æ®æ‹¿åˆ°ä¹‹åŽï¼Œç›´æŽ¥å°±è¿™æ ·ï¼š

``` js
$.ajax({
  url: '/api/v1/userlist',
  success: function(result) {
    // ä¾æ¬¡æ‰§è¡Œå®¹å™¨é‡Œçš„æ–¹æ³•
    $emit(result)
  }
})
```

è¿™ç§å§¿åŠ¿æ¯”ä¼ ç»Ÿçš„`$.ajax()`è¦å¥½ï¼

---

å‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼çš„æ€æƒ³æ˜¯ï¼š

> äº‹å…ˆæŠŠè¦å¹²çš„äº‹ç»™è®¡åˆ’å¥½ï¼ˆæŠŠ`callback`æ‰”åˆ°ä¸€ä¸ªæ± å­é‡ŒåŽ»ï¼‰ï¼Œå½“åˆ°è¾¾æŒ‡å®šæ¡ä»¶çš„æ—¶å€™ï¼ˆ`ajax`è¯·æ±‚æˆåŠŸï¼Œå“åº”å›žæ¥æ•°æ®ï¼‰æˆ–è€…è¯´æŸç§ä¿¡å·æ¥äº†ï¼Œå°±ä¾æ¬¡æ‰§è¡Œå®¹å™¨é‡Œçš„æ–¹æ³•ï¼

![å‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼çš„æ€æƒ³](assets/img/2020-08-07-01-30-14.png)

è¿™åŒäº‹ä»¶æ± æœºåˆ¶ä¸€æ ·ï¼Œç›‘å¬äº‹ä»¶ï¼Œä¿¡å·æ¥äº†ï¼Œä¾æ¬¡æ‰§è¡Œäº‹ä»¶æ± é‡Œçš„`callback`

è¡¥å……ï¼š

è§‚å¯Ÿè€…æ¨¡å¼ vs å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼š

![è§‚å¯Ÿè€…æ¨¡å¼ vs å‘å¸ƒè®¢é˜…æ¨¡å¼](assets/img/2020-08-07-01-44-50.png)

æœ‰äººè¿™æ ·ç†è§£å®ƒä»¬äºŒè€…çš„åŒºåˆ«ï¼š

1. å‘å¸ƒ-è®¢é˜…æ¨¡å¼å°±å¥½åƒæŠ¥ç¤¾ï¼Œ é‚®å±€å’Œä¸ªäººçš„å…³ç³»ï¼ŒæŠ¥çº¸çš„è®¢é˜…å’Œåˆ†å‘æ˜¯ç”±é‚®å±€æ¥å®Œæˆçš„ã€‚æŠ¥ç¤¾åªè´Ÿè´£å°†æŠ¥çº¸å‘é€ç»™é‚®å±€ã€‚
2. è§‚å¯Ÿè€…æ¨¡å¼å°±å¥½åƒ ä¸ªä½“å¥¶å†œå’Œä¸ªäººçš„å…³ç³»ã€‚å¥¶å†œè´Ÿè´£ç»Ÿè®¡æœ‰å¤šå°‘äººè®¢äº†äº§å“ï¼Œæ‰€ä»¥ä¸ªäººéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åŒæ‹¿ç‰›å¥¶çš„æ–¹æ³•ã€‚å¥¶å†œæœ‰æ–°å¥¶äº†å°±è´Ÿè´£è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼š

> åŒå‘ç»‘å®šçš„æ•ˆæžœå¯ä»¥ç†è§£æˆè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå•å‘æ•°æ®æµçš„æ•ˆæžœå¯ä»¥ç†è§£æˆå‘å¸ƒè®¢é˜…æ¨¡å¼

å…¶å®žå‘å¸ƒè€…å°±æ˜¯èµ„æºçš„ç”Ÿäº§è€…ï¼Œè€Œè®¢é˜…è€…å°±æ˜¯éœ€è¦èµ„æºçš„äººï¼ˆä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…ï¼‰ï¼Œæˆ‘ä»¬æ˜¯çº¿ä¸‹é¢å¯¹é¢äº¤æ˜“ï¼Ÿè¿˜æ˜¯ç½‘ä¸Šäº¤æ˜“ï¼Ÿ

2ï¼‰æ˜¯ä»€ä¹ˆ

è®¤è¯†å®ƒï¼Œä½ å¾—çŸ¥é“è¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µï¼š

1. å‘å¸ƒè€… -> ç”Ÿäº§è€…ï¼ˆç”Ÿäº§çš„æ˜¯`callback`ï¼‰ -> è‡ªå®šä¹‰äº‹ä»¶æ± ï¼ˆ`$pond`ï¼‰ -> ä¹Ÿå°±æ˜¯è‡ªå®šä¹‰çš„ä¸€ä¸ªå®¹å™¨ -> æ³¨æ„è¿™å¯ä¸æ˜¯æµè§ˆå™¨å†…ç½®çš„äº‹ä»¶å“ˆï¼
2. è®¢é˜…è€… -> ä¹°å®¶ï¼ˆç›‘å¬æŸä¸ªä¿¡å·`$on()`ï¼‰ï¼Œä¹°å®¶è¿˜å¯ä»¥é€€è´§ï¼ˆç§»é™¤æŸä¸ªä¿¡å·çš„`callback`ï¼Œ`$off()`ï¼‰
3. ä¸­ä»‹ -> ç½‘åº—ï¼Œé€šçŸ¥ä¹°å®¶æ”¶è´¹ï¼ˆå‘å¸ƒæŸä¸ªä¿¡å·ï¼Œ`$emit()/fire()`ï¼Œä¸ºä½•å‘å¸ƒï¼Ÿå› ä¸ºã€Œå‘å¸ƒè€…ã€æŠŠä¸œè¥¿ç”Ÿäº§å‡ºæ¥äº†ï¼‰

## â˜…å†™ä¸€ä¸ª

1ï¼‰ä¸ºå•¥è¦ç”¨é¢å‘å¯¹è±¡å§¿åŠ¿å°è£…æ’ä»¶ï¼Ÿ

2ï¼‰ES6 çš„ class è¯­æ³•ã€è£…é¥°å™¨

3ï¼‰å†™ä¸€ä¸ªä½“çŽ°å‘å¸ƒè®¢é˜…è®¾è®¡æ¨¡å¼æ€æƒ³çš„ä»£ç 

> è€å¸ˆå¹¶æ²¡æœ‰å¼„ä¸‰ä¸ªclasså‡ºæ¥ï¼Œç›´æŽ¥å°±æ˜¯ç”¨ä¸‰ä¸ªAPIæ¥ä»£è¡¨ä¸‰ç§æ“ä½œï¼

1. è‡ªæ‰§è¡Œå‡½æ•°
2. åˆ›å»º `Sub` -> å®šä¹‰åŽŸåž‹æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰ã€ŒAPI æŽ¥å£ã€ -> `$pondã€$onã€$offã€$emit` -> è¿™äº› API çš„è®¾è®¡æ˜¯ä»¿ç…§ Vue çš„ eventBus
3. `new Sub` -> ä½¿ç”¨
