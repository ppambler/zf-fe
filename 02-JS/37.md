| ✍️ Tangxt | ⏳ 2020-08-05 | 🏷️ 设计模式 |

# 37-发布订阅设计模式

## ★前言

从服务器获取数据：

1. 数据分析
2. 数据绑定
3. DOM 元素的相关操作
4. ……

元素监听用户行为：

1. 接收到了信号
2. 信号分析
3. 执行 callback
4. 数据绑定
5. DOM 元素的相关操作
6. ……

## ★是什么？

1）概述

> 透过事件池机制，来让你了解什么是「发布订阅设计模式」

我们使用 jQuery 的 ajax 方法，来发送 ajax 请求：

``` js
$.ajax({
  url: '/api/v1/userlist',
  success: function(result) {
    fn1(result)
    fn2(result)
    fn3(result)
  }
})

function fn1() {}

function fn2() {}

function fn3() {}
```

也可以使用 axios：

``` js
axios.get('/api/v1/userlist')
.then(res => {})
.catch((err) => {})
```

也可以使用发布订阅设计模式：

先规划好拿到数据之后，应该要做什么：

把 callback 扔到一个容器里边去 -> `$on(fn1)`、`$on(fn2)` -> 也可以移除 callback（`$off`）

数据拿到之后，直接就这样：

``` js
$.ajax({
  url: '/api/v1/userlist',
  success: function(result) {
    // 依次执行容器里的方法
    $emit(result)
  }
})
```

这种姿势比传统的`$.ajax()`要好！

---

发布订阅设计模式的思想是：

> 事先把要干的事给计划好（把`callback`扔到一个池子里去），当到达指定条件的时候（`ajax`请求成功，响应回来数据）或者说某种信号来了，就依次执行容器里的方法！

这同事件池机制一样，监听事件，信号来了，依次执行事件池里的`callback`

2）是什么

认识它，你得知道这么几个概念：

1. 自定义事件池 -> 也就是自定义的一个容器 -> 注意这可不是浏览器内置的事件哈！

## ★写一个

1）为啥要用面向对象姿势封装插件？

2）ES6 的 class 语法、装饰器

3）写一个体现发布订阅设计模式思想的代码

1. 自执行函数
2. 创建 `Sub` -> 定义原型方法，也就是定义「API 接口」 -> `$pond、$on、$off、$emit` -> 这些 API 的设计是仿照 Vue 的 eventBus
3. `new Sub` -> 使用
